"use strict";(self.webpackChunkflowise_ui=self.webpackChunkflowise_ui||[]).push([[5801],{42016:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(23917);const o={getAllAPIKeys:()=>a.Z.get("/apikey"),createNewAPI:e=>a.Z.post("/apikey",e),updateAPI:(e,t)=>a.Z.put("/apikey/".concat(e),t),deleteAPI:e=>a.Z.delete("/apikey/".concat(e))}},76858:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(23917);const o={getAllChatflows:()=>a.Z.get("/chatflows"),getSpecificChatflow:e=>a.Z.get("/chatflows/".concat(e)),getSpecificChatflowFromPublicEndpoint:e=>a.Z.get("/public-chatflows/".concat(e)),createNewChatflow:e=>a.Z.post("/chatflows",e),updateChatflow:(e,t)=>a.Z.put("/chatflows/".concat(e),t),deleteChatflow:e=>a.Z.delete("/chatflows/".concat(e)),getIsChatflowStreaming:e=>a.Z.get("/chatflows-streaming/".concat(e))}},14464:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(15749),o=n(30969),s=n(48886),i=n(38357),r=n(87130),l=n(33656),c=n(91862),d=n(46138),u=n(52312),h=n(37574);const p=e=>{let{show:t,dialogProps:n,onCancel:p,onConfirm:m}=e;const f=document.getElementById("portal"),[g,x]=(0,o.useState)(""),[y,v]=(0,o.useState)(!1);(0,o.useEffect)((()=>{v(!!g)}),[g]);const w=t?(0,h.jsxs)(s.Z,{open:t,fullWidth:!0,maxWidth:"xs",onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,h.jsx)(i.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:n.title}),(0,h.jsx)(r.Z,{children:(0,h.jsx)(l.Z,{sx:{mt:1},id:"chatflow-name",type:"text",fullWidth:!0,placeholder:"My New Chatflow",value:g,onChange:e=>x(e.target.value)})}),(0,h.jsxs)(c.Z,{children:[(0,h.jsx)(d.Z,{onClick:p,children:n.cancelButtonName}),(0,h.jsx)(u.S,{disabled:!y,variant:"contained",onClick:()=>m(g),children:n.confirmButtonName})]})]}):null;return(0,a.createPortal)(w,f)}},46315:(e,t,n)=>{n.d(t,{Z:()=>b});var a=n(15749),o=n(69405),s=n(30969),i=n(2383),r=n(46138),l=n(48886),c=n(38357),d=n(87130),u=n(43108),h=n(67888),p=n(33656),m=n(11100),f=n(91243),g=n(91862),x=n(49009),y=n(52312),v=n(33926),w=n(76858),j=n(37574);const b=e=>{let{show:t,dialogProps:n,onCancel:b,onConfirm:C}=e;const S=document.getElementById("portal"),k=(0,o.I0)();(0,v.Z)();const Z=function(){return k((0,i.yv)(...arguments))},D=function(){return k((0,i.sy)(...arguments))},[I,P]=(0,s.useState)([{prompt:""}]),[T,A]=(0,s.useState)({}),N=()=>{P([...I,{prompt:""}])};(0,s.useEffect)((()=>{if(n.chatflow&&n.chatflow.chatbotConfig)try{let e=JSON.parse(n.chatflow.chatbotConfig);if(A(e||{}),e.starterPrompts){let t=[];Object.getOwnPropertyNames(e.starterPrompts).forEach((n=>{e.starterPrompts[n]&&t.push(e.starterPrompts[n])})),P(t)}else P([{prompt:""}])}catch(e){P([{prompt:""}])}return()=>{}}),[n]),(0,s.useEffect)((()=>(k(t?{type:i.tS}:{type:i.Go}),()=>k({type:i.Go}))),[t,k]);const E=t?(0,j.jsxs)(l.Z,{onClose:b,open:t,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,j.jsx)(c.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:n.title||"Conversation Starter Prompts"}),(0,j.jsxs)(d.Z,{children:[(0,j.jsx)("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10},children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,j.jsx)(x.mhH,{size:30,color:"#2d6a4f"}),(0,j.jsx)("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"Starter prompts will only be shown when there is no messages on the chat"})]})}),(0,j.jsx)(u.Z,{sx:{"& > :not(style)":{m:1},pt:2},children:(0,j.jsx)(h.Z,{children:I.map(((e,t)=>(0,j.jsxs)("div",{style:{display:"flex",width:"100%"},children:[(0,j.jsx)(u.Z,{sx:{width:"95%",mb:1},children:(0,j.jsx)(p.Z,{sx:{width:"100%"},type:"text",onChange:e=>((e,t)=>{const{name:n,value:a}=t.target,o=[...I];o[e][n]=a,P(o)})(t,e),size:"small",value:e.prompt,name:"prompt",endAdornment:(0,j.jsx)(m.Z,{position:"end",sx:{padding:"2px"},children:I.length>1&&(0,j.jsx)(f.Z,{sx:{height:30,width:30},size:"small",color:"error",disabled:1===I.length,onClick:()=>(e=>{const t=[...I];t.splice(e,1),P(t)})(t),edge:"end",children:(0,j.jsx)(x.IT9,{})})})},t)}),(0,j.jsx)(u.Z,{sx:{width:"5%",mb:1},children:t===I.length-1&&(0,j.jsx)(f.Z,{color:"primary",onClick:N,children:(0,j.jsx)(x.SC9,{})})})]},t)))})})]}),(0,j.jsxs)(g.Z,{children:[(0,j.jsx)(r.Z,{onClick:b,children:"Cancel"}),(0,j.jsx)(y.S,{variant:"contained",onClick:async()=>{try{let e={starterPrompts:{...I}};T.starterPrompts=e.starterPrompts;const t=await w.Z.updateChatflow(n.chatflow.id,{chatbotConfig:JSON.stringify(T)});t.data&&(Z({message:"Conversation Starter Prompts Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,j.jsx)(r.Z,{style:{color:"white"},onClick:()=>D(e),children:(0,j.jsx)(x.kLi,{})})}}),k({type:i.ch,chatflow:t.data})),C()}catch(e){const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);Z({message:"Failed to save Conversation Starter Prompts: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,j.jsx)(r.Z,{style:{color:"white"},onClick:()=>D(e),children:(0,j.jsx)(x.kLi,{})})}})}},children:"Save"})]})]}):null;return(0,a.createPortal)(E,S)}},44878:(e,t,n)=>{n.r(t),n.d(t,{default:()=>cn});var a=n(30969),o=n(48428),s=n(5378),i=n(18658),r=(n(30599),n(69405)),l=n(13026);function c(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{navigator:n}=(0,a.useContext)(l.Us);(0,a.useEffect)((()=>{if(!t)return;const a=n.block((t=>{const n={...t,retry(){a(),t.retry()}};e(n)}));return a}),[n,e,t])}((0,a.useCallback)((t=>{window.confirm(e)&&t.retry()}),[e]),t)}var d=n(2383),u=n(50576),h=n(46138),p=n(43108),m=n(39088),f=n(34777),g=n(94702),x=n(45971),y=n(91243),v=n(47915),w=n(75295),j=n(6779),b=n(2295),C=n(55705),S=n(5107),k=n(22526),Z=n(27341),D=n(15749),I=n(48886),P=n(38357),T=n(87130),A=n(82309),N=n(56349),E=n(7836),M=n(10741),R=n(92472),L=n(61758),F=n(85481),O=n(37574);const q=e=>{let{columns:t,rows:n,sx:a}=e;return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(A.Z,{component:N.Z,children:(0,O.jsxs)(E.Z,{sx:{minWidth:650,...a},"aria-label":"simple table",children:[(0,O.jsx)(M.Z,{children:(0,O.jsx)(R.Z,{children:t.map(((e,t)=>(0,O.jsx)(L.Z,{children:e.charAt(0).toUpperCase()+e.slice(1)},t)))})}),(0,O.jsx)(F.Z,{children:n.map(((e,t)=>(0,O.jsx)(R.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:Object.keys(e).map(((t,n)=>(0,O.jsx)(L.Z,{children:e[t]},n)))},t)))})]})})})};var B=n(11021),z=n(23917);const J=e=>z.Z.get("/flow-config/".concat(e)),U=e=>z.Z.post("/node-config",e);var H=n(60990);const _=e=>{var t;let{show:n,dialogProps:o,onCancel:s}=e;const i=document.getElementById("portal"),l=(0,r.I0)(),c=(0,H.Z)(U);(0,a.useEffect)((()=>{o.data&&c.request(o.data)}),[o]),(0,a.useEffect)((()=>(l(n?{type:d.tS}:{type:d.Go}),()=>l({type:d.Go}))),[n,l]);const u=n?(0,O.jsxs)(I.Z,{onClose:s,open:n,fullWidth:!0,maxWidth:"md","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,O.jsx)(P.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:o.data&&o.data.name&&o.data.label&&(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,O.jsx)("div",{style:{width:50,height:50,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:(0,O.jsx)("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:o.data.name,src:"".concat(B.v2,"/api/v1/node-icon/").concat(o.data.name)})}),(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",marginLeft:10},children:[o.data.label,(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,O.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginBottom:5},children:(0,O.jsx)("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:o.data.id})}),o.data.version&&(0,O.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"#e9edc9",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginLeft:10,marginBottom:5},children:(0,O.jsxs)("span",{style:{color:"#606c38",fontSize:"0.825rem"},children:["version ",o.data.version]})}),o.data.badge&&(0,O.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"DEPRECATING"===o.data.badge?"#ffe57f":"#52b69a",padding:5,paddingLeft:10,paddingRight:10,marginTop:5,marginLeft:10,marginBottom:5},children:(0,O.jsx)("span",{style:{color:"DEPRECATING"!==o.data.badge?"white":"inherit",fontSize:"0.825rem"},children:o.data.badge})})]})]})]})}),(0,O.jsxs)(T.Z,{children:[(null===(t=o.data)||void 0===t?void 0:t.description)&&(0,O.jsx)("div",{style:{padding:10,marginBottom:10},children:(0,O.jsx)("span",{children:o.data.description})}),c.data&&c.data.length>0&&(0,O.jsx)(q,{rows:c.data.map((e=>{const{node:t,nodeId:n,...a}=e;return a})),columns:Object.keys(c.data[0]).slice(-3)})]})]}):null;return(0,D.createPortal)(u,i)};var W=n(49009),K=n(99177);const G=(0,x.ZP)(C.Z)((e=>{let{theme:t}=e;return{background:t.palette.card.main,color:t.darkTextPrimary,border:"solid 1px",borderColor:t.palette.primary[200]+75,width:"300px",height:"auto",padding:"10px",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)","&:hover":{borderColor:t.palette.primary.main}}})),V=(0,x.ZP)((e=>{let{className:t,...n}=e;return(0,O.jsx)(j.Z,{...n,classes:{popper:t}})}))((e=>{let{theme:t}=e;return{["& .".concat(b.Z.tooltip)]:{backgroundColor:t.palette.nodeToolTip.background,color:t.palette.nodeToolTip.color,boxShadow:t.shadows[1]}}})),Y=e=>{var t,n,o,s,i,l;let{data:c}=e;const d=(0,g.Z)(),u=(0,r.v9)((e=>e.canvas)),{deleteNode:m,duplicateNode:f}=(0,a.useContext)(K.K),[x,b]=(0,a.useState)(!1),[C,D]=(0,a.useState)({}),[I,P]=(0,a.useState)(!1),[T,A]=(0,a.useState)({}),[N,E]=(0,a.useState)(""),[M,R]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{const e=u.componentNodes.find((e=>e.name===c.name));var t;e&&(c.version?c.version&&e.version>c.version?E(((e,t)=>"Node version ".concat(e," outdated\nUpdate to latest version ").concat(t))(c.version,e.version)):"DEPRECATING"===e.badge&&E("This node will be deprecated in the next release. Change to a new node tagged with NEW"):E((t=e.version,"Node outdated\nUpdate to latest version ".concat(t))))}),[u.componentNodes,c.name,c.version]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(G,{content:!1,sx:{padding:0,borderColor:c.selected?d.palette.primary.main:d.palette.text.secondary},border:!1,children:(0,O.jsx)(V,{open:!u.canvasDialogShow&&M,onClose:()=>{R(!1)},onOpen:()=>{R(!0)},disableFocusListener:!0,title:(0,O.jsxs)("div",{style:{background:"transparent",display:"flex",flexDirection:"column"},children:[(0,O.jsx)(y.Z,{title:"Duplicate",onClick:()=>{f(c.id)},sx:{height:"35px",width:"35px","&:hover":{color:null===d||void 0===d?void 0:d.palette.primary.main}},color:null!==d&&void 0!==d&&null!==(t=d.customization)&&void 0!==t&&t.isDarkMode?null===(n=d.colors)||void 0===n?void 0:n.paper:"inherit",children:(0,O.jsx)(W.vUr,{})}),(0,O.jsx)(y.Z,{title:"Delete",onClick:()=>{m(c.id)},sx:{height:"35px",width:"35px","&:hover":{color:"red"}},color:null!==d&&void 0!==d&&null!==(o=d.customization)&&void 0!==o&&o.isDarkMode?null===(s=d.colors)||void 0===s?void 0:s.paper:"inherit",children:(0,O.jsx)(W.IT9,{})}),(0,O.jsx)(y.Z,{title:"Info",onClick:()=>{A({data:c}),P(!0)},sx:{height:"35px",width:"35px","&:hover":{color:null===d||void 0===d?void 0:d.palette.secondary.main}},color:null!==d&&void 0!==d&&null!==(i=d.customization)&&void 0!==i&&i.isDarkMode?null===(l=d.colors)||void 0===l?void 0:l.paper:"inherit",children:(0,O.jsx)(W.Us8,{})})]}),placement:"right-start",children:(0,O.jsxs)(p.Z,{children:[(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,O.jsx)(p.Z,{style:{width:50,marginRight:10,padding:5},children:(0,O.jsx)("div",{style:{...d.typography.commonAvatar,...d.typography.largeAvatar,backgroundColor:"#EEEEEE",cursor:"grab"},children:(0,O.jsx)("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},src:"".concat(B.v2,"/api/v1/node-icon/").concat(c.name),alt:"Notification"})})}),(0,O.jsx)(p.Z,{children:(0,O.jsx)(v.Z,{sx:{fontSize:"1rem",fontWeight:500,mr:2},children:c.label})}),N&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{style:{flexGrow:1}}),(0,O.jsx)(j.Z,{title:(0,O.jsx)("span",{style:{whiteSpace:"pre-line"},children:N}),placement:"top",children:(0,O.jsx)(y.Z,{sx:{height:35,width:35},children:(0,O.jsx)(W.DpU,{size:35,color:"orange"})})})]})]}),(c.inputAnchors.length>0||c.inputParams.length>0)&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(w.Z,{}),(0,O.jsx)(p.Z,{sx:{background:d.palette.asyncSelect.main,p:1},children:(0,O.jsx)(v.Z,{sx:{fontWeight:500,textAlign:"center"},children:"Inputs"})}),(0,O.jsx)(w.Z,{})]}),c.inputAnchors.map(((e,t)=>(0,O.jsx)(S.Z,{inputAnchor:e,data:c},t))),c.inputParams.filter((e=>!e.hidden)).map(((e,t)=>(0,O.jsx)(S.Z,{inputParam:e,data:c},t))),c.inputParams.find((e=>e.additionalParams))&&(0,O.jsx)("div",{style:{textAlign:"center",marginTop:c.inputParams.filter((e=>e.additionalParams)).length===c.inputParams.length+c.inputAnchors.length?20:0},children:(0,O.jsx)(h.Z,{disableRipple:!0,sx:{width:"90%",mb:2},onClick:()=>{const e={data:c,inputParams:c.inputParams.filter((e=>e.additionalParams)),confirmButtonName:"Save",cancelButtonName:"Cancel"};D(e),b(!0)},children:"Additional Parameters"})}),(0,O.jsx)(w.Z,{}),(0,O.jsx)(p.Z,{sx:{background:d.palette.asyncSelect.main,p:1},children:(0,O.jsx)(v.Z,{sx:{fontWeight:500,textAlign:"center"},children:"Output"})}),(0,O.jsx)(w.Z,{}),c.outputAnchors.map(((e,t)=>(0,O.jsx)(k.Z,{outputAnchor:e,data:c},t)))]})})}),(0,O.jsx)(Z.Z,{show:x,dialogProps:C,onCancel:()=>b(!1)}),(0,O.jsx)(_,{show:I,dialogProps:T,onCancel:()=>P(!1)})]})};n(86420);const X=e=>{let{id:t,sourceX:n,sourceY:s,targetX:i,targetY:l,sourcePosition:c,targetPosition:u,style:h={},data:p,markerEnd:m}=e;const[f,g,x]=(0,o.OQ)({sourceX:n,sourceY:s,sourcePosition:c,targetX:i,targetY:l,targetPosition:u}),{deleteEdge:y}=(0,a.useContext)(K.K),v=(0,r.I0)();return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("path",{id:t,style:h,className:"react-flow__edge-path",d:f,markerEnd:m}),p&&p.label&&(0,O.jsx)(o.f6,{x:n+10,y:s+10,label:p.label,labelStyle:{fill:"black"},labelBgStyle:{fill:"transparent"},labelBgPadding:[2,4],labelBgBorderRadius:2}),(0,O.jsx)("foreignObject",{width:40,height:40,x:g-20,y:x-20,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,O.jsx)("div",{children:(0,O.jsx)("button",{className:"edgebutton",onClick:e=>((e,t)=>{e.stopPropagation(),y(t),v({type:d.K8})})(e,t),children:"\xd7"})})})]})};var $=n(6596),Q=n(59467),ee=n(25139),te=n(98483),ne=n(46259),ae=n(71127),oe=n(67888),se=n(42558),ie=n.n(se),re=n(15742),le=n(37616);const ce={IconTrash:W.IT9,IconFileUpload:W.XuY,IconFileExport:W.D57,IconCopy:W.vUr,IconSearch:W.jVj,IconMessage:W.fu1,IconPictureInPictureOff:W.RZO},de={id:"settings",title:"",type:"group",children:[{id:"conversationStarters",title:"Starter Prompts",type:"item",url:"",icon:ce.IconPictureInPictureOff},{id:"viewMessages",title:"View Messages",type:"item",url:"",icon:ce.IconMessage},{id:"duplicateChatflow",title:"Duplicate Chatflow",type:"item",url:"",icon:ce.IconCopy},{id:"loadChatflow",title:"Load Chatflow",type:"item",url:"",icon:ce.IconFileUpload},{id:"exportChatflow",title:"Export Chatflow",type:"item",url:"",icon:ce.IconFileExport},{id:"analyseChatflow",title:"Analyse Chatflow",type:"item",url:"",icon:ce.IconSearch},{id:"deleteChatflow",title:"Delete Chatflow",type:"item",url:"",icon:ce.IconTrash}]},ue=e=>{let{chatflow:t,isSettingsOpen:n,anchorEl:o,onSettingsItemClick:s,onUploadFile:i,onClose:r}=e;const l=(0,g.Z)(),[c,d]=(0,a.useState)([]),[u,h]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(t&&!t.id){const e=de.children.filter((e=>"loadChatflow"===e.id));d(e)}else if(t&&t.id){const e=de.children;d(e)}}),[t]),(0,a.useEffect)((()=>{h(n)}),[n]);const m=c.map((e=>(0,O.jsx)(le.Z,{item:e,level:1,navType:"SETTINGS",onClick:e=>s(e),onUploadFile:i},e.id)));return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(ne.Z,{placement:"bottom-end",open:u,anchorEl:o,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[170,20]}}]},sx:{zIndex:1e3},children:e=>{let{TransitionProps:t}=e;return(0,O.jsx)(re.Z,{in:u,...t,children:(0,O.jsx)(N.Z,{children:(0,O.jsx)(ae.d,{onClickAway:r,children:(0,O.jsx)(C.Z,{border:!1,elevation:16,content:!1,boxShadow:!0,shadow:l.shadows[16],children:(0,O.jsx)(ie(),{style:{height:"100%",maxHeight:"calc(100vh - 250px)",overflowX:"hidden"},children:(0,O.jsx)(p.Z,{sx:{p:2},children:(0,O.jsx)(oe.Z,{children:m})})})})})})})}})})};var he=n(14464),pe=n(73447),me=n(8288),fe=n(72002),ge=n(80928),xe=n(17187),ye=n(14891),ve=n(23038),we=n(34061),je=n(98545),be=n(70475),Ce=n(33656),Se=n(35531),ke=n(52312),Ze=n(97251),De=n(76858),Ie=n(33926);const Pe="#ffffff",Te=16,Ae="#303235",Ne={backgroundColor:"#f7f8ff",textColor:"#303235"},Ee={backgroundColor:"#3B81F6",textColor:"#ffffff"},Me={backgroundColor:"#ffffff",textColor:"#303235",sendButtonColor:"#3B81F6"},Re=e=>{var t,n,o,s,i,l,c,u,m,f,x,w,j,b,C,S,k,Z,D,I,P,T,A,N,E,M,R,L,F,q,z,J;let{isSessionMemory:U}=e;const H=(0,r.I0)(),_=(0,g.Z)(),K=(0,r.v9)((e=>e.canvas.chatflow)),G=K.id,V=K.chatbotConfig?JSON.parse(K.chatbotConfig):{};(0,Ie.Z)();const Y=function(){return H((0,d.yv)(...arguments))},X=function(){return H((0,d.sy)(...arguments))},[$,Q]=(0,a.useState)(null!==(t=K.isPublic)&&void 0!==t&&t),[te,ne]=(0,a.useState)(null!==(n=null===V||void 0===V?void 0:V.generateNewSession)&&void 0!==n&&n),[ae,oe]=(0,a.useState)(null!==(o=null===V||void 0===V?void 0:V.title)&&void 0!==o?o:""),[se,ie]=(0,a.useState)(null!==(s=null===V||void 0===V?void 0:V.titleAvatarSrc)&&void 0!==s?s:""),[re,le]=(0,a.useState)(null!==(i=null===V||void 0===V?void 0:V.welcomeMessage)&&void 0!==i?i:""),[ce,de]=(0,a.useState)(null!==(l=null===V||void 0===V?void 0:V.backgroundColor)&&void 0!==l?l:Pe),[ue,he]=(0,a.useState)(null!==(c=null===V||void 0===V?void 0:V.fontSize)&&void 0!==c?c:Te),[pe,me]=(0,a.useState)(null!==(u=null===V||void 0===V?void 0:V.poweredByTextColor)&&void 0!==u?u:Ae),[fe,ge]=(0,a.useState)(null!==(m=null===V||void 0===V||null===(f=V.botMessage)||void 0===f?void 0:f.backgroundColor)&&void 0!==m?m:Ne.backgroundColor),[xe,ye]=(0,a.useState)(null!==(x=null===V||void 0===V||null===(w=V.botMessage)||void 0===w?void 0:w.textColor)&&void 0!==x?x:Ne.textColor),[ve,we]=(0,a.useState)(null!==(j=null===V||void 0===V||null===(b=V.botMessage)||void 0===b?void 0:b.avatarSrc)&&void 0!==j?j:""),[Re,Le]=(0,a.useState)(null!==(C=null===V||void 0===V||null===(S=V.botMessage)||void 0===S?void 0:S.showAvatar)&&void 0!==C&&C),[Fe,Oe]=(0,a.useState)(null!==(k=null===V||void 0===V||null===(Z=V.userMessage)||void 0===Z?void 0:Z.backgroundColor)&&void 0!==k?k:Ee.backgroundColor),[qe,Be]=(0,a.useState)(null!==(D=null===V||void 0===V||null===(I=V.userMessage)||void 0===I?void 0:I.textColor)&&void 0!==D?D:Ee.textColor),[ze,Je]=(0,a.useState)(null!==(P=null===V||void 0===V||null===(T=V.userMessage)||void 0===T?void 0:T.avatarSrc)&&void 0!==P?P:""),[Ue,He]=(0,a.useState)(null!==(A=null===V||void 0===V||null===(N=V.userMessage)||void 0===N?void 0:N.showAvatar)&&void 0!==A&&A),[_e,We]=(0,a.useState)(null!==(E=null===V||void 0===V||null===(M=V.textInput)||void 0===M?void 0:M.backgroundColor)&&void 0!==E?E:Me.backgroundColor),[Ke,Ge]=(0,a.useState)(null!==(R=null===V||void 0===V||null===(L=V.textInput)||void 0===L?void 0:L.textColor)&&void 0!==R?R:Me.textColor),[Ve,Ye]=(0,a.useState)(null!==(F=null===V||void 0===V||null===(q=V.textInput)||void 0===q?void 0:q.placeholder)&&void 0!==F?F:""),[Xe,$e]=(0,a.useState)(null!==(z=null===V||void 0===V||null===(J=V.textInput)||void 0===J?void 0:J.sendButtonColor)&&void 0!==z?z:Me.sendButtonColor),[Qe,et]=(0,a.useState)(null),[tt,nt]=(0,a.useState)(""),[at,ot]=(0,a.useState)(""),st=Boolean(Qe),[it,rt]=(0,a.useState)(null),lt=Boolean(it),ct=()=>{const e={botMessage:{showAvatar:!1},userMessage:{showAvatar:!1},textInput:{},overrideConfig:{}};return ae&&(e.title=ae),se&&(e.titleAvatarSrc=se),re&&(e.welcomeMessage=re),ce&&(e.backgroundColor=ce),ue&&(e.fontSize=ue),pe&&(e.poweredByTextColor=pe),fe&&(e.botMessage.backgroundColor=fe),xe&&(e.botMessage.textColor=xe),ve&&(e.botMessage.avatarSrc=ve),Re&&(e.botMessage.showAvatar=Re),Fe&&(e.userMessage.backgroundColor=Fe),qe&&(e.userMessage.textColor=qe),ze&&(e.userMessage.avatarSrc=ze),Ue&&(e.userMessage.showAvatar=Ue),_e&&(e.textInput.backgroundColor=_e),Ke&&(e.textInput.textColor=Ke),Ve&&(e.textInput.placeholder=Ve),Xe&&(e.textInput.sendButtonColor=Xe),U&&(e.overrideConfig.generateNewSession=te),null!==V&&void 0!==V&&V.starterPrompts&&(e.starterPrompts=V.starterPrompts),e},dt=()=>{rt(null)},ut=(e,t,n)=>(0,O.jsx)(p.Z,{sx:{pt:2,pb:2},children:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,O.jsx)(v.Z,{sx:{mb:1},children:n}),(0,O.jsx)(p.Z,{sx:{cursor:"pointer",width:"30px",height:"30px",border:"1px solid #616161",marginRight:"10px",backgroundColor:null!==e&&void 0!==e?e:"#ffffff",borderRadius:"5px"},onClick:n=>{nt(t),ot(null!==e&&void 0!==e?e:"#ffffff"),et(n.currentTarget)}})]})}),ht=(e,t,n)=>(0,O.jsx)(p.Z,{sx:{pt:2,pb:2},children:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,O.jsx)(v.Z,{sx:{mb:1},children:n}),(0,O.jsx)(be.Z,{id:t,checked:e,onChange:e=>{((e,t)=>{switch(t){case"botMessageShowAvatar":Le(e);break;case"userMessageShowAvatar":He(e);break;case"generateNewSession":ne(e)}})(e.target.checked,t)}})]})}),pt=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"string",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return(0,O.jsx)(p.Z,{sx:{pt:2,pb:2},children:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,O.jsx)(v.Z,{sx:{mb:1},children:n}),(0,O.jsx)(Ce.Z,{id:t,type:a,fullWidth:!0,value:e,placeholder:o,name:t,onChange:e=>{((e,t)=>{switch(t){case"title":oe(e);break;case"titleAvatarSrc":ie(e);break;case"welcomeMessage":le(e);break;case"fontSize":he(e);break;case"botMessageAvatarSrc":we(e);break;case"userMessageAvatarSrc":Je(e);break;case"textInputPlaceholder":Ye(e)}})(e.target.value,t)}})]})})};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(ee.Z,{direction:"row",children:[(0,O.jsx)(v.Z,{sx:{p:1,borderRadius:10,backgroundColor:_.palette.primary.light,width:"max-content",height:"max-content"},variant:"h5",children:"".concat(B.v2,"/chatbot/").concat(G)}),(0,O.jsx)(y.Z,{title:"Copy Link",color:"success",onClick:e=>{navigator.clipboard.writeText("".concat(B.v2,"/chatbot/").concat(G)),rt(e.currentTarget),setTimeout((()=>{dt()}),1500)},children:(0,O.jsx)(W.vUr,{})}),(0,O.jsx)(y.Z,{title:"Open New Tab",color:"primary",onClick:()=>window.open("".concat(B.v2,"/chatbot/").concat(G),"_blank"),children:(0,O.jsx)(W.m7l,{})}),(0,O.jsx)("div",{style:{flex:1}}),(0,O.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,O.jsx)(be.Z,{checked:$,onChange:e=>{Q(e.target.checked),(async e=>{try{const t=await De.Z.updateChatflow(G,{isPublic:e});t.data&&(Y({message:"Chatbot Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>X(e),children:(0,O.jsx)(W.kLi,{})})}}),H({type:d.ch,chatflow:t.data}))}catch(t){console.error(t);const e=t.response.data||"".concat(t.response.status,": ").concat(t.response.statusText);Y({message:"Failed to save Chatbot Configuration: ".concat(e),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>X(e),children:(0,O.jsx)(W.kLi,{})})}})}})(e.target.checked)}}),(0,O.jsx)(v.Z,{children:"Make Public"}),(0,O.jsx)(Ze.H,{style:{marginLeft:10},title:"Making public will allow anyone to access the chatbot without username & password"})]})]}),pt(ae,"title","Title","string","Flowise Assistant"),pt(se,"titleAvatarSrc","Title Avatar Link","string","https://raw.githubusercontent.com/FlowiseAI/Flowise/main/assets/FloWiseAI_dark.png"),pt(re,"welcomeMessage","Welcome Message","string","Hello! This is custom welcome message"),ut(ce,"backgroundColor","Background Color"),pt(ue,"fontSize","Font Size","number"),ut(pe,"poweredByTextColor","PoweredBy TextColor"),(0,O.jsx)(v.Z,{variant:"h4",sx:{mb:1,mt:2},children:"Bot Message"}),ut(fe,"botMessageBackgroundColor","Background Color"),ut(xe,"botMessageTextColor","Text Color"),pt(ve,"botMessageAvatarSrc","Avatar Link","string","https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png"),ht(Re,"botMessageShowAvatar","Show Avatar"),(0,O.jsx)(v.Z,{variant:"h4",sx:{mb:1,mt:2},children:"User Message"}),ut(Fe,"userMessageBackgroundColor","Background Color"),ut(qe,"userMessageTextColor","Text Color"),pt(ze,"userMessageAvatarSrc","Avatar Link","string","https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png"),ht(Ue,"userMessageShowAvatar","Show Avatar"),(0,O.jsx)(v.Z,{variant:"h4",sx:{mb:1,mt:2},children:"Text Input"}),ut(_e,"textInputBackgroundColor","Background Color"),ut(Ke,"textInputTextColor","Text Color"),pt(Ve,"textInputPlaceholder","TextInput Placeholder","string","Type question.."),ut(Xe,"textInputSendButtonColor","TextIntput Send Button Color"),U&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(v.Z,{variant:"h4",sx:{mb:1,mt:2},children:"Session Memory"}),ht(te,"generateNewSession","Start new session when chatbot link is opened or refreshed")]}),(0,O.jsx)(ke.S,{style:{marginBottom:10,marginTop:10},variant:"contained",onClick:()=>(async()=>{try{const e=await De.Z.updateChatflow(G,{chatbotConfig:JSON.stringify(ct())});e.data&&(Y({message:"Chatbot Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>X(e),children:(0,O.jsx)(W.kLi,{})})}}),H({type:d.ch,chatflow:e.data}))}catch(e){console.error(e);const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);Y({message:"Failed to save Chatbot Configuration: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>X(e),children:(0,O.jsx)(W.kLi,{})})}})}})(),children:"Save Changes"}),(0,O.jsx)(Se.ZP,{open:st,anchorEl:Qe,onClose:()=>{et(null)},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,O.jsx)(je.xS,{color:at,onChange:e=>(e=>{switch(tt){case"backgroundColor":de(e);break;case"poweredByTextColor":me(e);break;case"botMessageBackgroundColor":ge(e);break;case"botMessageTextColor":ye(e);break;case"userMessageBackgroundColor":Oe(e);break;case"userMessageTextColor":Be(e);break;case"textInputBackgroundColor":We(e);break;case"textInputTextColor":Ge(e);break;case"textInputSendButtonColor":$e(e)}ot(e)})(e.hex)})}),(0,O.jsx)(Se.ZP,{open:lt,anchorEl:it,onClose:dt,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,O.jsx)(v.Z,{variant:"h6",sx:{pl:1,pr:1,color:"white",background:_.palette.success.dark},children:"Copied!"})})]})};var Le=n(36597),Fe=n(14682);const Oe=e=>{let{value:t,label:n,onChange:o,disabled:s=!1}=e;const[i,r]=(0,a.useState)(t);return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(Le.Z,{sx:{mt:1,width:"100%"},size:"small",control:(0,O.jsx)(Fe.Z,{disabled:s,checked:i,onChange:e=>{r(e.target.checked),o(e.target.checked)}}),label:n})})};function qe(e){const{children:t,value:n,index:a,...o}=e;return(0,O.jsx)("div",{role:"tabpanel",hidden:n!==a,id:"attachment-tabpanel-".concat(a),"aria-labelledby":"attachment-tab-".concat(a),...o,children:n===a&&(0,O.jsx)(p.Z,{sx:{p:1},children:t})})}function Be(e){return{id:"attachment-tab-".concat(e),"aria-controls":"attachment-tabpanel-".concat(e)}}const ze=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?'button: {\n                    backgroundColor: "#3B81F6",\n                    right: 20,\n                    bottom: 20,\n                    size: "medium",\n                    iconColor: "white",\n                    customIconSrc: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/svg/google-messages.svg",\n                }':'button: {\n                backgroundColor: "#3B81F6",\n                right: 20,\n                bottom: 20,\n                size: "medium",\n                iconColor: "white",\n                customIconSrc: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/main/svg/google-messages.svg",\n            }'},Je=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?'chatWindow: {\n                    welcomeMessage: "Hello! This is custom welcome message",\n                    backgroundColor: "#ffffff",\n                    height: 700,\n                    width: 400,\n                    fontSize: 16,\n                    poweredByTextColor: "#303235",\n                    botMessage: {\n                        backgroundColor: "#f7f8ff",\n                        textColor: "#303235",\n                        showAvatar: true,\n                        avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png",\n                    },\n                    userMessage: {\n                        backgroundColor: "#3B81F6",\n                        textColor: "#ffffff",\n                        showAvatar: true,\n                        avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png",\n                    },\n                    textInput: {\n                        placeholder: "Type your question",\n                        backgroundColor: "#ffffff",\n                        textColor: "#303235",\n                        sendButtonColor: "#3B81F6",\n                    }\n                }':'chatWindow: {\n                welcomeMessage: "Hello! This is custom welcome message",\n                backgroundColor: "#ffffff",\n                height: 700,\n                width: 400,\n                fontSize: 16,\n                poweredByTextColor: "#303235",\n                botMessage: {\n                    backgroundColor: "#f7f8ff",\n                    textColor: "#303235",\n                    showAvatar: true,\n                    avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png",\n                },\n                userMessage: {\n                    backgroundColor: "#3B81F6",\n                    textColor: "#ffffff",\n                    showAvatar: true,\n                    avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png",\n                },\n                textInput: {\n                    placeholder: "Type your question",\n                    backgroundColor: "#ffffff",\n                    textColor: "#303235",\n                    sendButtonColor: "#3B81F6",\n                }\n            }'},Ue=e=>{let{chatflowid:t}=e;const n=["Popup Html","Fullpage Html","Popup React","Fullpage React"],[o,s]=(0,a.useState)(0),[i,r]=(0,a.useState)(!1),l=e=>{r(e)},c=e=>{switch(e){case"Popup Html":return(e=>'<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/gh/letsgomaslow/fusionflow@embedchat-branding/fusionflow-ChatEmbed/dist/web.js"\n    Chatbot.init({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(B.v2,'",\n    })\n<\/script>'))(t);case"Fullpage Html":return(e=>'<flowise-fullchatbot></flowise-fullchatbot>\n<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/gh/letsgomaslow/fusionflow@embedchat-branding/fusionflow-ChatEmbed/dist/web.js"\n    Chatbot.initFull({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(B.v2,'",\n    })\n<\/script>'))(t);case"Popup React":return(e=>"import { BubbleChat } from 'flowise-embed-react'\n\nconst App = () => {\n    return (\n        <BubbleChat chatflowid=\"".concat(e,'" apiHost="').concat(B.v2,'" />\n    );\n};'))(t);case"Fullpage React":return(e=>'import { FullPageChat } from "flowise-embed-react"\n\nconst App = () => {\n    return (\n        <FullPageChat\n            chatflowid="'.concat(e,'"\n            apiHost="').concat(B.v2,'"\n        />\n    );\n};'))(t);default:return""}},d=e=>{switch(e){case"Popup Html":return(e=>'<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/gh/letsgomaslow/fusionflow@embedchat-branding/fusionflow-ChatEmbed/dist/web.js"\n    Chatbot.init({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(B.v2,'",\n        chatflowConfig: {\n            // topK: 2\n        },\n        theme: {\n            ').concat(ze(),",\n            ").concat(Je(),"\n        }\n    })\n<\/script>"))(t);case"Fullpage Html":return(e=>'<flowise-fullchatbot></flowise-fullchatbot>\n<script type="module">\n    import Chatbot from "https://cdn.jsdelivr.net/gh/letsgomaslow/fusionflow@embedchat-branding/fusionflow-ChatEmbed/dist/web.js"\n    Chatbot.initFull({\n        chatflowid: "'.concat(e,'",\n        apiHost: "').concat(B.v2,'",\n        theme: {\n            ').concat(Je(),"\n        }\n    })\n<\/script>"))(t);case"Popup React":return(e=>"import { BubbleChat } from 'flowise-embed-react'\n\nconst App = () => {\n    return (\n        <BubbleChat\n            chatflowid=\"".concat(e,'"\n            apiHost="').concat(B.v2,'"\n            theme={{\n                ').concat(ze(!0),",\n                ").concat(Je(!0),"\n            }}\n        />\n    );\n};"))(t);case"Fullpage React":return(e=>'import { FullPageChat } from "flowise-embed-react"\n\nconst App = () => {\n    return (\n        <FullPageChat\n            chatflowid="'.concat(e,'"\n            apiHost="').concat(B.v2,'"\n            theme={{\n                ').concat(Je(!0),"\n            }}\n        />\n    );\n};"))(t);default:return""}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,O.jsx)("div",{style:{flex:80},children:(0,O.jsx)(pe.Z,{value:o,onChange:(e,t)=>{s(t)},"aria-label":"tabs",children:n.map(((e,t)=>(0,O.jsx)(me.Z,{label:e,...Be(t)},t)))})})}),(0,O.jsx)("div",{style:{marginTop:10}}),n.map(((e,t)=>(0,O.jsxs)(qe,{value:o,index:t,children:[(0===o||1===o)&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("span",{children:["Paste this anywhere in the ",(0,O.jsx)("code",{children:"<body>"})," tag of your html file."]}),(0,O.jsx)("div",{style:{height:10}})]}),(0,O.jsx)(ye.Z1,{theme:ye.FE,text:c(e),language:"javascript",showLineNumbers:!1,wrapLines:!0}),(0,O.jsx)(Oe,{label:"Show Embed Chat Config",value:i,onChange:l}),i&&(0,O.jsx)(ye.Z1,{theme:ye.FE,text:d(e),language:"javascript",showLineNumbers:!1,wrapLines:!0})]},t)))]})},He=()=>{var e,t,n,o,s,i;const l=(0,r.I0)(),c=(0,r.v9)((e=>e.canvas.chatflow)),u=c.id,m=c.apiConfig?JSON.parse(c.apiConfig):{};(0,Ie.Z)();const f=function(){return l((0,d.yv)(...arguments))},g=function(){return l((0,d.sy)(...arguments))},[x,y]=(0,a.useState)(null!==(e=null===m||void 0===m||null===(t=m.rateLimit)||void 0===t?void 0:t.limitMax)&&void 0!==e?e:""),[w,j]=(0,a.useState)(null!==(n=null===m||void 0===m||null===(o=m.rateLimit)||void 0===o?void 0:o.limitDuration)&&void 0!==n?n:""),[b,C]=(0,a.useState)(null!==(s=null===m||void 0===m||null===(i=m.rateLimit)||void 0===i?void 0:i.limitMsg)&&void 0!==s?s:""),S=()=>{const e={rateLimit:{}},t=[!x,!w,!b].filter((e=>!1===e));if(t.length>=1&&t.length<=2)throw new Error("Need to fill all rate limit input fields");return 3===t.length&&(e.rateLimit={limitMax:x,limitDuration:w,limitMsg:b}),e},k=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"string",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return(0,O.jsx)(p.Z,{sx:{pt:2,pb:2},children:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,O.jsx)(v.Z,{sx:{mb:1},children:n}),(0,O.jsx)(Ce.Z,{id:t,type:a,fullWidth:!0,value:e,placeholder:o,name:t,onChange:e=>{((e,t)=>{switch(t){case"limitMax":y(e);break;case"limitDuration":j(e);break;case"limitMsg":C(e)}})(e.target.value,t)}})]})})};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(v.Z,{variant:"h4",sx:{mb:1,mt:2},children:["Rate Limit"," ",(0,O.jsx)(Ze.H,{style:{mb:1,mt:2,marginLeft:10},title:'Visit <a target="_blank" href="https://docs.flowiseai.com/rate-limit">Rate Limit Setup Guide</a> to set up Rate Limit correctly in your hosting environment.'})]}),k(x,"limitMax","Message Limit per Duration","number"),k(w,"limitDuration","Duration in Second","number"),k(b,"limitMsg","Limit Message","string"),(0,O.jsx)(ke.S,{style:{marginBottom:10,marginTop:10},variant:"contained",onClick:()=>(async()=>{try{const e=await De.Z.updateChatflow(u,{apiConfig:JSON.stringify(S())});e.data&&(f({message:"API Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>g(e),children:(0,O.jsx)(W.kLi,{})})}}),l({type:d.ch,chatflow:e.data}))}catch(e){console.error(e);const t=e.response?e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText):e.message;f({message:"Failed to save API Configuration: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>g(e),children:(0,O.jsx)(W.kLi,{})})}})}})(),children:"Save Changes"})]})};const _e=n.p+"static/media/python.b0fd2326ee21d9c5524d0d243379c879.svg";const We=n.p+"static/media/javascript.0baf38b3d3f5b2d24e87fb5cc2fcfea0.svg";const Ke=n.p+"static/media/cURL.37eb8ccceafb9e8630a53aa0eb756128.svg";const Ge=n.p+"static/media/embed.289f71beedf481a4fab870e9fed16fec.svg",Ve=n.p+"static/media/sharing.932311c91d3fa05253cc.png";const Ye=n.p+"static/media/settings.b8495df74c95f19ef6411b17f7b81f27.svg";var Xe=n(42016),$e=n(86115);function Qe(e){const{children:t,value:n,index:a,...o}=e;return(0,O.jsx)("div",{role:"tabpanel",hidden:n!==a,id:"attachment-tabpanel-".concat(a),"aria-labelledby":"attachment-tab-".concat(a),...o,children:n===a&&(0,O.jsx)(p.Z,{sx:{p:1},children:t})})}function et(e){return{id:"attachment-tab-".concat(e),"aria-controls":"attachment-tabpanel-".concat(e)}}const tt=e=>{var t,n;let{show:o,dialogProps:s,onCancel:i}=e;const c=document.getElementById("portal"),u=(0,l.s0)(),h=(0,r.I0)(),p=["Embed","Python","JavaScript","cURL","Share Chatbot","Configuration"],[m,f]=(0,a.useState)(0),[g,x]=(0,a.useState)([]),[y,w]=(0,a.useState)([]),[j,b]=(0,a.useState)(""),[C,S]=(0,a.useState)({}),[k,Z]=(0,a.useState)(!1),[A,N]=(0,a.useState)({}),[E,M]=(0,a.useState)({}),R=(0,H.Z)(Xe.Z.getAllAPIKeys),L=(0,H.Z)(De.Z.updateChatflow),F=(0,H.Z)(De.Z.getIsChatflowStreaming),z=(0,H.Z)(J),U=e=>{Z(e),e&&z.request(s.chatflowid)},_=e=>(t,n)=>{const a={...E};a[e]=n,M(a)};(0,a.useEffect)((()=>{L.data&&h({type:d.ch,chatflow:L.data})}),[L.data,h]),(0,a.useEffect)((()=>{z.data&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={},a=e.reduce((function(e,a){return e[a.node]=e[a.node]||[],e[a.node].push(a),n[a.node]=!!t,e}),Object.create(null));N(a),M(n)}(z.data)}),[z.data]);const K=e=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\n\ndef query(payload):\n    response = requests.post(API_URL, json=payload)\n    return response.json()\n    \noutput = query({\n    "question": "Hey, how are you?",\n})\n'):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({"question": "Hey, how are you?"}).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?"}\' \\\n     -H "Content-Type: application/json"'):"",G=e=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"}\n\ndef query(payload):\n    response = requests.post(API_URL, headers=headers, json=payload)\n    return response.json()\n    \noutput = query({\n    "question": "Hey, how are you?",\n})\n'):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: {\n                Authorization: "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'",\n                "Content-Type": "application/json"\n            },\n            method: "POST",\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({"question": "Hey, how are you?"}).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?"}\' \\\n     -H "Content-Type: application/json" \\\n     -H "Authorization: Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"'):"",V=e=>"Python"===e?"python":"JavaScript"===e?"javascript":"cURL"===e?"bash":"python",Y=e=>"Python"===e?_e:"JavaScript"===e?We:"Embed"===e?Ge:"cURL"===e?Ke:"Share Chatbot"===e?Ve:"Configuration"===e?Ye:_e,X=(e,t)=>{if("Python"===e){let e=(t=(0,$e.VN)(t))[0].type;return e.includes(",")&&(e=e.split(",")[0]),'import requests\n\nAPI_URL = "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\n\n# use form data to upload files\nform_data = {\n    "files": ',"('example".concat(e,"', open('example").concat(e,"', 'rb'))"),"\n}\nbody_data = {").concat((0,$e.nJ)(t,"formData"),"}\n\ndef query(form_data):\n    response = requests.post(API_URL, files=form_data, data=body_data)\n    return response.json()\n\noutput = query(form_data)\n")}return"JavaScript"===e?"// use FormData to upload files\nlet formData = new FormData();\n".concat((0,$e.Ln)(t,"formData"),'\nasync function query(formData) {\n    const response = await fetch(\n        "').concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            body: formData\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery(formData).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid," \\\n     -X POST \\").concat((0,$e.CJ)(t,"formData"),' \\\n     -H "Content-Type: multipart/form-data"'):""},$=(e,t)=>{if("Python"===e){let e=(t=(0,$e.VN)(t))[0].type;return e.includes(",")&&(e=e.split(",")[0]),'import requests\n\nAPI_URL = "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"}\n\n# use form data to upload files\nform_data = {\n    "files": ',"('example".concat(e,"', open('example").concat(e,"', 'rb'))"),"\n}\nbody_data = {").concat((0,$e.nJ)(t,"formData"),"}\n\ndef query(form_data):\n    response = requests.post(API_URL, headers=headers, files=form_data, data=body_data)\n    return response.json()\n\noutput = query(form_data)\n")}return"JavaScript"===e?"// use FormData to upload files\nlet formData = new FormData();\n".concat((0,$e.Ln)(t,"formData"),'\nasync function query(formData) {\n    const response = await fetch(\n        "').concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: { Authorization: "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'" },\n            method: "POST",\n            body: formData\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery(formData).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid," \\\n     -X POST \\").concat((0,$e.CJ)(t,"formData"),' \\\n     -H "Content-Type: multipart/form-data" \\\n     -H "Authorization: Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"'):""},Q=(e,t)=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\n\ndef query(payload):\n    response = requests.post(API_URL, json=payload)\n    return response.json()\n\noutput = query({\n    "question": "Hey, how are you?",\n    "overrideConfig": {').concat((0,$e.nJ)(t,"json"),"\n    }\n})\n"):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({\n  "question": "Hey, how are you?",\n  "overrideConfig": {').concat((0,$e.Ln)(t,"json"),"\n  }\n}).then((response) => {\n    console.log(response);\n});\n"):"cURL"===e?"curl ".concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?", "overrideConfig": {').concat((0,$e.CJ)(t,"json"),'}\' \\\n     -H "Content-Type: application/json"'):"",ee=(e,t)=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'"\nheaders = {"Authorization": "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"}\n\ndef query(payload):\n    response = requests.post(API_URL, headers=headers, json=payload)\n    return response.json()\n\noutput = query({\n    "question": "Hey, how are you?",\n    "overrideConfig": {').concat((0,$e.nJ)(t,"json"),"\n    }\n})\n"):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,'",\n        {\n            headers: {\n                Authorization: "Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'",\n                "Content-Type": "application/json"\n            },\n            method: "POST",\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({\n  "question": "Hey, how are you?",\n  "overrideConfig": {').concat((0,$e.Ln)(t,"json"),"\n  }\n}).then((response) => {\n    console.log(response);\n});\n"):"cURL"===e?"curl ".concat(B.v2,"/api/v1/prediction/").concat(s.chatflowid,' \\\n     -X POST \\\n     -d \'{"question": "Hey, how are you?", "overrideConfig": {').concat((0,$e.CJ)(t,"json"),'}\' \\\n     -H "Content-Type: application/json" \\\n     -H "Authorization: Bearer ').concat(null===C||void 0===C?void 0:C.apiKey,'"'):"",te=e=>"Python"===e?'body_data = {\n    "openAIApiKey[chatOpenAI_0]": "sk-my-openai-1st-key",\n    "openAIApiKey[openAIEmbeddings_0]": "sk-my-openai-2nd-key"\n}':"JavaScript"===e?'formData.append("openAIApiKey[chatOpenAI_0]", "sk-my-openai-1st-key")\nformData.append("openAIApiKey[openAIEmbeddings_0]", "sk-my-openai-2nd-key")':"cURL"===e?'-F "openAIApiKey[chatOpenAI_0]=sk-my-openai-1st-key" \\\n-F "openAIApiKey[openAIEmbeddings_0]=sk-my-openai-2nd-key" \\':void 0;(0,a.useEffect)((()=>{if(R.data){const e=[{label:"No Authorization",name:""}];for(const t of R.data)e.push({label:t.keyName,name:t.id});e.push({label:"- Add New Key -",name:"addnewkey"}),x(e),w(R.data),s.chatflowApiKeyId&&(b(s.chatflowApiKeyId),S(R.data.find((e=>e.id===s.chatflowApiKeyId))))}}),[s,R.data]),(0,a.useEffect)((()=>{o&&(R.request(),F.request(s.chatflowid))}),[o]);const ne=o?(0,O.jsxs)(I.Z,{open:o,fullWidth:!0,maxWidth:"md",onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,O.jsx)(P.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:s.title}),(0,O.jsxs)(T.Z,{children:[(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,O.jsx)("div",{style:{flex:80},children:(0,O.jsx)(pe.Z,{value:m,onChange:(e,t)=>{f(t)},"aria-label":"tabs",children:p.map(((e,t)=>(0,O.jsx)(me.Z,{icon:(0,O.jsx)("img",{style:{objectFit:"cover",height:15,width:"auto"},src:Y(e),alt:"code"}),iconPosition:"start",label:e,...et(t)},t)))})}),(0,O.jsx)("div",{style:{flex:20},children:(0,O.jsx)(we.L,{name:"SelectKey",disableClearable:!0,options:g,onSelect:e=>(e=>{if("addnewkey"===e)return void u("/apikey");b(e),S(y.find((t=>t.id===e)));const t={apikeyid:e};L.request(s.chatflowid,t)})(e),value:null!==(t=null!==(n=s.chatflowApiKeyId)&&void 0!==n?n:j)&&void 0!==t?t:"Choose an API key"})})]}),(0,O.jsx)("div",{style:{marginTop:10}}),p.map(((e,t)=>(0,O.jsxs)(Qe,{value:m,index:t,children:[("Embed"===e||"Share Chatbot"===e)&&j&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("p",{children:"You cannot use API key while embedding/sharing chatbot."}),(0,O.jsxs)("p",{children:["Please select ",(0,O.jsx)("b",{children:'"No Authorization"'})," from the dropdown at the top right corner."]})]}),"Embed"===e&&!j&&(0,O.jsx)(Ue,{chatflowid:s.chatflowid}),"Embed"!==e&&"Share Chatbot"!==e&&"Configuration"!==e&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(ye.Z1,{theme:ye.FE,text:j?G(e):K(e),language:V(e),showLineNumbers:!1,wrapLines:!0}),(0,O.jsx)(Oe,{label:"Show Input Config",value:k,onChange:U}),k&&z.data&&z.data.length>0&&(0,O.jsxs)(O.Fragment,{children:[Object.keys(A).sort().map((e=>(0,O.jsxs)(fe.Z,{expanded:E[e]||!1,onChange:_(e),disableGutters:!0,children:[(0,O.jsx)(ge.Z,{expandIcon:(0,O.jsx)(ve.Z,{}),"aria-controls":"nodes-accordian-".concat(e),id:"nodes-accordian-header-".concat(e),children:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,O.jsx)(v.Z,{variant:"h5",children:e}),(0,O.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:(0,O.jsx)("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:A[e][0].nodeId})})]})}),(0,O.jsx)(xe.Z,{children:(0,O.jsx)(q,{rows:A[e].map((e=>{const{node:t,nodeId:n,...a}=e;return a})),columns:Object.keys(A[e][0]).slice(-3)})})]},e))),(0,O.jsx)(ye.Z1,{theme:ye.FE,text:j?s.isFormDataRequired?$(e,z.data):ee(e,z.data):s.isFormDataRequired?X(e,z.data):Q(e,z.data),language:V(e),showLineNumbers:!1,wrapLines:!0}),(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10,marginTop:10,marginBottom:10},children:[(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,O.jsx)(W.mhH,{size:30,color:"#2d6a4f"}),(0,O.jsx)("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"You can also specify multiple values for a config parameter by specifying the node id"})]}),(0,O.jsx)("div",{style:{padding:10},children:(0,O.jsx)(ye.Z1,{theme:ye.FE,text:s.isFormDataRequired?te(e):'{\n    "overrideConfig": {\n        "openAIApiKey": {\n            "chatOpenAI_0": "sk-my-openai-1st-key",\n            "openAIEmbeddings_0": "sk-my-openai-2nd-key"\n        }\n    }\n}',language:V(e),showLineNumbers:!1,wrapLines:!0})})]})]})]}),"Share Chatbot"===e&&!j&&(0,O.jsx)(Re,{isSessionMemory:s.isSessionMemory}),"Configuration"===e&&(0,O.jsx)(He,{})]},t)))]})]}):null;return(0,D.createPortal)(ne,c)};var nt=n(54279),at=n(25599),ot=n(86008),st=n(91862),it=n(76387),rt=n(83795),lt=n(38760);const ct=[{label:"LangSmith",name:"langSmith",icon:n.p+"static/media/langchain.03999e05472fc2689e39.png",url:"https://smith.langchain.com",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["langsmithApi"]},{label:"Project Name",name:"projectName",type:"string",optional:!0,description:"If not provided, default will be used",placeholder:"default"},{label:"On/Off",name:"status",type:"boolean",optional:!0}]},{label:"LangFuse",name:"langFuse",icon:n.p+"static/media/langfuse.c3fcac167cd0e18502e7583f5fbe7be7.svg",url:"https://langfuse.com",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["langfuseApi"]},{label:"Release",name:"release",type:"string",optional:!0,description:"The release number/hash of the application to provide analytics grouped by release"},{label:"On/Off",name:"status",type:"boolean",optional:!0}]},{label:"LLMonitor",name:"llmonitor",icon:n.p+"static/media/lunary.4e5c25a7ec33a54bd00981129f33e94c.svg",url:"https://llmonitor.com",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["llmonitorApi"]},{label:"On/Off",name:"status",type:"boolean",optional:!0}]}],dt=e=>{let{show:t,dialogProps:n,onCancel:o}=e;const s=document.getElementById("portal"),i=(0,r.I0)();(0,Ie.Z)();const l=function(){return i((0,d.yv)(...arguments))},c=function(){return i((0,d.sy)(...arguments))},[u,m]=(0,a.useState)({}),[f,g]=(0,a.useState)({}),x=(e,t,n)=>{let a={};a=Object.prototype.hasOwnProperty.call(u,t)?{...u}:{...u,[t]:{}},a[t][n]=e,m(a)};(0,a.useEffect)((()=>{if(n.chatflow&&n.chatflow.analytic)try{m(JSON.parse(n.chatflow.analytic))}catch(e){m({}),console.error(e)}return()=>{m({}),g({})}}),[n]),(0,a.useEffect)((()=>(i(t?{type:d.tS}:{type:d.Go}),()=>i({type:d.Go}))),[t,i]);const y=t?(0,O.jsxs)(I.Z,{onClose:o,open:t,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,O.jsx)(P.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"Analyse Chatflow"}),(0,O.jsx)(T.Z,{children:ct.map(((e,t)=>{return(0,O.jsxs)(fe.Z,{expanded:f[e.name]||!1,onChange:(n=e.name,(e,t)=>{const a={...f};a[n]=t,g(a)}),disableGutters:!0,children:[(0,O.jsx)(ge.Z,{expandIcon:(0,O.jsx)(ve.Z,{}),"aria-controls":e.name,id:e.name,children:(0,O.jsxs)(nt.ZP,{style:{padding:0,margin:0},alignItems:"center",children:[(0,O.jsx)(at.Z,{children:(0,O.jsx)("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white"},children:(0,O.jsx)("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:"AI",src:e.icon})})}),(0,O.jsx)(ot.Z,{sx:{ml:1},primary:e.label,secondary:(0,O.jsx)("a",{target:"_blank",rel:"noreferrer",href:e.url,children:e.url})}),u[e.name]&&u[e.name].status&&(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignContent:"center",alignItems:"center",background:"#d8f3dc",borderRadius:15,padding:5,paddingLeft:7,paddingRight:7,marginRight:10},children:[(0,O.jsx)("div",{style:{width:15,height:15,borderRadius:"50%",backgroundColor:"#70e000"}}),(0,O.jsx)("span",{style:{color:"#006400",marginLeft:10},children:"ON"})]})]})}),(0,O.jsx)(xe.Z,{children:e.inputs.map(((t,n)=>{var a,o;return(0,O.jsxs)(p.Z,{sx:{p:2},children:[(0,O.jsx)("div",{style:{display:"flex",flexDirection:"row"},children:(0,O.jsxs)(v.Z,{children:[t.label,!t.optional&&(0,O.jsx)("span",{style:{color:"red"},children:"\xa0*"}),t.description&&(0,O.jsx)(Ze.H,{style:{marginLeft:10},title:t.description})]})}),f[e.name]&&"credential"===t.type&&(0,O.jsx)(it.Z,{data:u[e.name]?{credential:u[e.name].credentialId}:{},inputParam:t,onSelect:t=>x(t,e.name,"credentialId")}),f[e.name]&&"boolean"===t.type&&(0,O.jsx)(rt.D,{onChange:n=>x(n,e.name,t.name),value:u[e.name]?u[e.name][t.name]:null!==(a=t.default)&&void 0!==a&&a}),f[e.name]&&("string"===t.type||"password"===t.type||"number"===t.type)&&(0,O.jsx)(lt.I,{inputParam:t,onChange:n=>x(n,e.name,t.name),value:u[e.name]?u[e.name][t.name]:null!==(o=t.default)&&void 0!==o?o:""})]},n)}))})]},t);var n}))}),(0,O.jsx)(st.Z,{children:(0,O.jsx)(ke.S,{variant:"contained",onClick:async()=>{try{const e=await De.Z.updateChatflow(n.chatflow.id,{analytic:JSON.stringify(u)});e.data&&(l({message:"Analytic Configuration Saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>c(e),children:(0,O.jsx)(W.kLi,{})})}}),i({type:d.ch,chatflow:e.data})),o()}catch(e){const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);l({message:"Failed to save Analytic Configuration: ".concat(t),options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>c(e),children:(0,O.jsx)(W.kLi,{})})}})}},children:"Save"})})]}):null;return(0,D.createPortal)(y,s)};var ut=n(92426),ht=n.n(ut),pt=n(17145),mt=n(86294),ft=n(39410),gt=n(288),xt=n(99661),yt=n(33485),vt=n(48598),wt=n(52053),jt=n.n(wt),bt=n(47804);const Ct=n.p+"static/media/account.bccec459ac1b2deab2d2.png";const St=n.p+"static/media/message_empty.e64ce71827642b3667c24731d5cfaaa0.svg";var kt=n(80598),Zt=n(62602),Dt=n(46804),It=n.n(Dt);const Pt=e=>{var t;let{show:n,dialogProps:o,onCancel:s}=e;const i=document.getElementById("portal"),l=(0,r.v9)((e=>e.customization)),[c,d]=(0,a.useState)({});(0,a.useEffect)((()=>(o.data&&d(o.data),()=>{d({})})),[o]);const u=n?(0,O.jsxs)(I.Z,{onClose:s,open:n,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,O.jsx)(P.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:null!==(t=o.title)&&void 0!==t?t:"Source Documents"}),(0,O.jsx)(T.Z,{children:(0,O.jsx)(It(),{theme:l.isDarkMode?"ocean":"rjv-default",style:{padding:10,borderRadius:10},src:c,name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1})})]}):null;return(0,D.createPortal)(u,i)};var Tt=n(95550);const At=e=>z.Z.get("/internal-chatmessage/".concat(e)),Nt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z.Z.get("/chatmessage/".concat(e),{params:{order:"DESC",...t}})},Et=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z.Z.get("/chatmessage/".concat(e),{params:{order:"ASC",...t}})},Mt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z.Z.delete("/chatmessage/".concat(e),{params:{...t}})};var Rt=n(60806);n(6882);const Lt=(0,a.forwardRef)((function(e,t){let{value:n,onClick:a}=e;return(0,O.jsx)(yt.Z,{style:{borderRadius:15,border:"1px solid #e0e0e0"},onClick:a,ref:t,children:n})})),Ft=e=>{let{show:t,dialogProps:n,onCancel:o}=e;const s=document.getElementById("portal"),i=(0,r.I0)(),l=(0,g.Z)(),c=(0,r.v9)((e=>e.customization)),{confirm:u}=(0,Rt.Z)();(0,Ie.Z)();const m=function(){return i((0,d.yv)(...arguments))},f=function(){return i((0,d.sy)(...arguments))},[x,y]=(0,a.useState)([]),[v,w]=(0,a.useState)([]),[b,C]=(0,a.useState)([]),[S,k]=(0,a.useState)(0),[Z,A]=(0,a.useState)(!1),[N,E]=(0,a.useState)({}),[M,R]=(0,a.useState)([]),[L,F]=(0,a.useState)((new Date).setMonth((new Date).getMonth()-1)),[q,z]=(0,a.useState)(new Date),J=(0,H.Z)(Nt),U=(0,H.Z)(Et),_=e=>{var t,n;const a=e.chatId,o=null!==(t=e.memoryType)&&void 0!==t?t:"null",s=null!==(n=e.sessionId)&&void 0!==n?n:"null";return"".concat(a,"_").concat(o,"_").concat(s)},K=e=>{let[t,n,...a]=e.split("_");const o=t,s=n,i=a.join("_"),r={chatId:o};return"null"!==s&&(r.memoryType=s),"null"!==i&&(r.sessionId=i),r},G=(e,t)=>{E({data:e,title:t}),A(!0)};(0,a.useEffect)((()=>{U.data&&(e=>{let t="";const n=[];for(let a=0;a<e.length;a+=1){const o=e[a];if(t){const e=o.createdDate.split("T")[0];e!==t&&(t=e,n.push({message:o.createdDate,type:"timeMessage"}))}else t=o.createdDate.split("T")[0],n.push({message:o.createdDate,type:"timeMessage"});const s={...o,message:o.content,type:o.role};o.sourceDocuments&&(s.sourceDocuments=JSON.parse(o.sourceDocuments)),o.usedTools&&(s.usedTools=JSON.parse(o.usedTools)),o.fileAnnotations&&(s.fileAnnotations=JSON.parse(o.fileAnnotations)),n.push(s)}C(n)})(U.data)}),[U.data]),(0,a.useEffect)((()=>{if(J.data){w(J.data);const e=(e=>{const t={},n=[];for(let a=0;a<e.length;a+=1){const o=_(e[a]),s=e[a];Object.prototype.hasOwnProperty.call(t,o)?Object.prototype.hasOwnProperty.call(t,o)&&1===t[o].counter&&(t[o]={counter:2,item:{...t[o].item,apiContent:"apiMessage"===t[o].item.role?"Bot: ".concat(t[o].item.content):"User: ".concat(t[o].item.content),userContent:"apiMessage"===s.role?"Bot: ".concat(s.content):"User: ".concat(s.content)}},n.push(t[o].item)):t[o]={counter:1,item:e[a]}}if(y(n),n.length)return _(n[0])})(J.data);k(0),e&&U.request(n.chatflow.id,K(e))}}),[J.data]),(0,a.useEffect)((()=>(n.chatflow&&J.request(n.chatflow.id),()=>{y([]),w([]),C([]),R([]),k(0),F((new Date).setMonth((new Date).getMonth()-1)),z(new Date)})),[n]),(0,a.useEffect)((()=>(i(t?{type:d.tS}:{type:d.Go}),()=>i({type:d.Go}))),[t,i]);const V=t?(0,O.jsxs)(I.Z,{onClose:o,open:t,fullWidth:!0,maxWidth:x&&0==x.length?"md":"lg","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,O.jsx)(P.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[n.title,(0,O.jsx)("div",{style:{flex:1}}),(0,O.jsx)(h.Z,{variant:"outlined",onClick:()=>(()=>{const e={};for(let n=0;n<v.length;n+=1){const o=v[n],s=_(o),i={content:o.content,role:"apiMessage"===o.role?"bot":"user",time:o.createdDate};var t,a;o.sourceDocuments&&(i.sourceDocuments=JSON.parse(o.sourceDocuments)),o.usedTools&&(i.usedTools=JSON.parse(o.usedTools)),o.fileAnnotations&&(i.fileAnnotations=JSON.parse(o.fileAnnotations)),Object.prototype.hasOwnProperty.call(e,s)?Object.prototype.hasOwnProperty.call(e,s)&&(e[s].messages=[...e[s].messages,i]):e[s]={id:o.chatId,source:"INTERNAL"===o.chatType?"UI":"API/Embed",sessionId:null!==(t=o.sessionId)&&void 0!==t?t:null,memoryType:null!==(a=o.memoryType)&&void 0!==a?a:null,messages:[i]}}const o=[];for(const n in e)o.push({...e[n]});for(let n=0;n<o.length;n+=1)o[n].messages=o[n].messages.reverse();const s=JSON.stringify(o,null,2),i="data:application/json;charset=utf-8,"+encodeURIComponent(s),r="".concat(n.chatflow.id,"-Message.json");let l=document.createElement("a");l.setAttribute("href",i),l.setAttribute("download",r),l.click()})(),startIcon:(0,O.jsx)(W.D57,{}),children:"Export"})]})}),(0,O.jsx)(T.Z,{children:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%",marginBottom:10},children:[(0,O.jsxs)("div",{style:{marginRight:10},children:[(0,O.jsx)("b",{style:{marginRight:10},children:"From Date"}),(0,O.jsx)(jt(),{selected:L,onChange:e=>(e=>{F(e),J.request(n.chatflow.id,{startDate:e,endDate:q,chatType:M.length?M:void 0})})(e),selectsStart:!0,startDate:L,endDate:q,customInput:(0,O.jsx)(Lt,{})})]}),(0,O.jsxs)("div",{style:{marginRight:10},children:[(0,O.jsx)("b",{style:{marginRight:10},children:"To Date"}),(0,O.jsx)(jt(),{selected:q,onChange:e=>(e=>{z(e),J.request(n.chatflow.id,{endDate:e,startDate:L,chatType:M.length?M:void 0})})(e),selectsEnd:!0,startDate:L,endDate:q,minDate:L,maxDate:new Date,customInput:(0,O.jsx)(Lt,{})})]}),(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",minWidth:"200px",marginRight:10},children:[(0,O.jsx)("b",{style:{marginRight:10},children:"Source"}),(0,O.jsx)(Tt.j,{name:"chatType",options:[{label:"UI",name:"INTERNAL"},{label:"API/Embed",name:"EXTERNAL"}],onSelect:e=>{return R(t=e),void J.request(n.chatflow.id,{chatType:t.length?t:void 0,startDate:L,endDate:q});var t},value:M,formControlSx:{mt:0}},JSON.stringify(M))]}),(0,O.jsx)("div",{style:{flex:1}})]}),(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[x&&0==x.length&&(0,O.jsxs)(ee.Z,{sx:{alignItems:"center",justifyContent:"center",width:"100%"},flexDirection:"column",children:[(0,O.jsx)(p.Z,{sx:{p:5,height:"auto"},children:(0,O.jsx)("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:St,alt:"msgEmptySVG"})}),(0,O.jsx)("div",{children:"No Messages"})]}),x&&x.length>0&&(0,O.jsx)("div",{style:{flexBasis:"40%"},children:(0,O.jsx)(p.Z,{sx:{overflowY:"auto",display:"flex",flexGrow:1,flexDirection:"column",maxHeight:"calc(100vh - 260px)"},children:x.map(((e,t)=>(0,O.jsx)(yt.Z,{sx:{p:0,borderRadius:"".concat(c.borderRadius,"px"),boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",mt:1,ml:1,mr:1,mb:t===x.length-1?1:0,"&.Mui-selected span":{color:c.isDarkMode?"#FFF860 !important":"#fff !important","&:hover span":{color:c.isDarkMode?"#FFF860 !important":"#fff !important"}},"&.Mui-selected p":{color:c.isDarkMode?"#fff !important":"#d9d1d1 !important","&:hover p":{color:c.isDarkMode?"#fff !important":"#d9d1d1 !important"}},"&:hover span":{color:c.isDarkMode?"#FFF860 !important":"#fff !important"},"&:hover p":{color:c.isDarkMode?"#fff !important":"#d9d1d1 !important"}},selected:S===t,onClick:()=>((e,t)=>{k(e),U.request(n.chatflow.id,K(_(t)))})(t,e),children:(0,O.jsx)(nt.ZP,{alignItems:"center",children:(0,O.jsx)(ot.Z,{primary:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",marginBottom:10},children:[(0,O.jsx)("span",{style:{color:c.isDarkMode?"#FFF860":"#121D35"},children:null===e||void 0===e?void 0:e.userContent}),(0,O.jsx)("div",{style:{maxHeight:"100px",maxWidth:"400px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:null===e||void 0===e?void 0:e.apiContent})]}),secondary:ht()(e.createdDate).format("MMMM Do YYYY, h:mm:ss a")})})},t)))})}),x&&x.length>0&&(0,O.jsxs)("div",{style:{flexBasis:"60%",paddingRight:"30px"},children:[b&&b.length>1&&(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,O.jsxs)("div",{style:{flex:1,marginLeft:"20px",marginBottom:"15px",marginTop:"10px"},children:[b[1].sessionId&&(0,O.jsxs)("div",{children:["Session Id:\xa0",(0,O.jsx)("b",{children:b[1].sessionId})]}),b[1].chatType&&(0,O.jsxs)("div",{children:["Source:\xa0",(0,O.jsx)("b",{children:"INTERNAL"===b[1].chatType?"UI":"API/Embed"})]}),b[1].memoryType&&(0,O.jsxs)("div",{children:["Memory:\xa0",(0,O.jsx)("b",{children:b[1].memoryType})]})]}),(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignContent:"center",alignItems:"end"},children:[(0,O.jsx)(ke.S,{sx:{height:"max-content",width:"max-content"},variant:"outlined",color:"error",title:"Clear Message",onClick:()=>(async e=>{const t={title:"Clear Session",description:e.sessionId&&e.memoryType?"Are you sure you want to clear session id: ".concat(e.sessionId," from ").concat(e.memoryType,"?"):"Are you sure you want to clear messages?",confirmButtonName:"Clear",cancelButtonName:"Cancel"},a=await u(t),o=n.chatflow.id;if(a)try{const t={chatflowid:o,isClearFromViewMessageDialog:!0};e.chatId&&(t.chatId=e.chatId),e.chatType&&(t.chatType=e.chatType),e.memoryType&&(t.memoryType=e.memoryType),e.sessionId&&(t.sessionId=e.sessionId),await Mt(o,t);const n=e.sessionId&&e.memoryType?"Succesfully cleared session id: ".concat(e.sessionId," from ").concat(e.memoryType):"Succesfully cleared messages";m({message:n,options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>f(e),children:(0,O.jsx)(W.kLi,{})})}}),J.request(o)}catch(s){const e=s.response.data||"".concat(s.response.status,": ").concat(s.response.statusText);m({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>f(e),children:(0,O.jsx)(W.kLi,{})})}})}})(b[1]),startIcon:(0,O.jsx)(W.W7f,{}),children:"Clear"}),b[1].sessionId&&(0,O.jsx)(j.Z,{title:"At your left \ud83d\udc48 you will see the Memory node that was used in this conversation. You need to have the matching Memory node with same parameters in the canvas, in order to delete the session conversations stored on the Memory node",placement:"bottom",children:(0,O.jsx)("h5",{style:{cursor:"pointer",color:l.palette.primary.main},children:"Why my session is not deleted?"})})]})]}),(0,O.jsx)("div",{style:{marginLeft:"20px",border:"1px solid #e0e0e0",borderRadius:"".concat(c.borderRadius,"px")},className:"cloud-message",children:(0,O.jsx)("div",{style:{width:"100%",height:"100%"},children:b&&b.map(((e,t)=>"apiMessage"===e.type||"userMessage"===e.type?(0,O.jsxs)(p.Z,{sx:{background:"apiMessage"===e.type?l.palette.asyncSelect.main:"",pl:1,pr:1},style:{display:"flex",justifyContent:"center",alignContent:"center"},children:["apiMessage"===e.type?(0,O.jsx)("img",{style:{marginLeft:"10px"},src:bt,alt:"AI",width:"25",height:"25",className:"boticon"}):(0,O.jsx)("img",{style:{marginLeft:"10px"},src:Ct,alt:"Me",width:"25",height:"25",className:"usericon"}),(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[e.usedTools&&(0,O.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.usedTools.map(((e,t)=>(0,O.jsx)(vt.Z,{size:"small",label:e.tool,component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,onClick:()=>G(e,"Used Tools")},t)))}),(0,O.jsx)("div",{className:"markdownanswer",children:(0,O.jsx)(kt.s,{remarkPlugins:[ft.Z,gt.Z],rehypePlugins:[pt.Z,mt.Z],components:{code(e){let{inline:t,className:a,children:o,...s}=e;const i=/language-(\w+)/.exec(a||"");return t?(0,O.jsx)("code",{className:a,...s,children:o}):(0,O.jsx)(Zt.d,{chatflowid:n.chatflow.id,isDialog:!0,language:i&&i[1]||"",value:String(o).replace(/\n$/,""),...s},Math.random())}},children:e.message})}),e.fileAnnotations&&(0,O.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.fileAnnotations.map(((e,t)=>(0,O.jsx)(h.Z,{sx:{fontSize:"0.85rem",textTransform:"none",mb:1,mr:1},variant:"outlined",onClick:()=>(async e=>{try{const t=await xt.Z.post("".concat(B.v2,"/api/v1/openai-assistants-file"),{fileName:e.fileName},{responseType:"blob"}),n=new Blob([t.data],{type:t.headers["content-type"]}),a=window.URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=e.fileName,document.body.appendChild(o),o.click(),o.remove()}catch(t){console.error("Download failed:",t)}})(e),endIcon:(0,O.jsx)(W.DjJ,{color:l.palette.primary.main}),children:e.fileName},t)))}),e.sourceDocuments&&(0,O.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:(0,$e.oY)(e).map(((e,t)=>{const n=e.metadata&&e.metadata.source?(0,$e.K2)(e.metadata.source):void 0;return(0,O.jsx)(vt.Z,{size:"small",label:n?"/"===n.pathname.substring(0,15)?n.host:"".concat(n.pathname.substring(0,15),"..."):"".concat(e.pageContent.substring(0,15),"..."),component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>{return n?(t=e.metadata.source,void window.open(t,"_blank")):G(e);var t}},t)}))})]})]},t):(0,O.jsx)(p.Z,{sx:{background:l.palette.timeMessage.main,p:2},style:{display:"flex",justifyContent:"center",alignContent:"center"},children:ht()(e.message).format("MMMM Do YYYY, h:mm:ss a")},t)))})})]})]}),(0,O.jsx)(Pt,{show:Z,dialogProps:N,onCancel:()=>A(!1)})]})})]}):null;return(0,D.createPortal)(V,s)};var Ot=n(46315);const qt=e=>{let{chatflow:t,handleSaveFlow:n,handleDeleteFlow:o,handleLoadFlow:s}=e;const i=(0,g.Z)(),c=(0,r.I0)(),u=(0,l.s0)(),h=(0,a.useRef)(),m=(0,a.useRef)(),[f,x]=(0,a.useState)(null),[y,w]=(0,a.useState)(""),[j,b]=(0,a.useState)(!1),[C,S]=(0,a.useState)(!1),[k,Z]=(0,a.useState)(!1),[D,I]=(0,a.useState)({}),[P,T]=(0,a.useState)(!1),[A,N]=(0,a.useState)({}),[E,M]=(0,a.useState)(!1),[R,L]=(0,a.useState)({}),[F,q]=(0,a.useState)(!1),[z,J]=(0,a.useState)({}),U=(0,H.Z)(De.Z.updateChatflow),_=(0,r.v9)((e=>e.canvas));return(0,a.useEffect)((()=>{U.data&&(w(U.data.name),c({type:d.ch,chatflow:U.data})),x(!1)}),[U.data]),(0,a.useEffect)((()=>{t&&w(t.name)}),[t]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(p.Z,{children:(0,O.jsx)($.Z,{title:"Back",sx:{borderRadius:"50%"},children:(0,O.jsx)(Q.Z,{variant:"square",sx:{...i.typography.commonAvatar,...i.typography.mediumAvatar,transition:"all .2s ease-in-out",background:"#E19379",color:"#ffffff","&:hover":{background:"#df6a43",color:"#ffffff"}},color:"inherit",onClick:()=>window.history.state&&window.history.state.idx>0?u(-1):u("/",{replace:!0}),children:(0,O.jsx)(W.ed9,{stroke:1.5,size:"1.3rem"})})})}),(0,O.jsxs)(p.Z,{sx:{flexGrow:1},children:[!f&&(0,O.jsxs)(ee.Z,{flexDirection:"row",children:[(0,O.jsxs)(v.Z,{sx:{fontSize:"1.5rem",fontWeight:600,ml:2},children:[_.isDirty&&(0,O.jsx)("strong",{style:{color:i.palette.orange.main},children:"*"})," ",y]}),(null===t||void 0===t?void 0:t.id)&&(0,O.jsx)($.Z,{title:"Edit Name",sx:{borderRadius:"50%"},children:(0,O.jsx)(Q.Z,{variant:"square",sx:{...i.typography.commonAvatar,...i.typography.mediumAvatar,transition:"all .2s ease-in-out",ml:1,background:"#E19379",color:"#ffffff","&:hover":{background:i.palette.secondary.dark,color:i.palette.secondary.light}},color:"inherit",onClick:()=>x(!0),children:(0,O.jsx)(W.TRY,{stroke:1.5,size:"1.3rem"})})})]}),f&&(0,O.jsxs)(ee.Z,{flexDirection:"row",children:[(0,O.jsx)(te.Z,{size:"small",inputRef:h,sx:{width:"50%",ml:2},defaultValue:y}),(0,O.jsx)($.Z,{title:"Save Name",sx:{borderRadius:"50%"},children:(0,O.jsx)(Q.Z,{variant:"square",sx:{...i.typography.commonAvatar,...i.typography.mediumAvatar,transition:"all .2s ease-in-out",background:"#469DBB",color:"#fff",ml:1,"&:hover":{backgroundColor:"#2398c1",color:"#fff"}},color:"inherit",onClick:()=>{if(t.id){const e={name:h.current.value};U.request(t.id,e)}},children:(0,O.jsx)(W.NOm,{stroke:1.5,size:"1.3rem"})})}),(0,O.jsx)($.Z,{title:"Cancel",sx:{borderRadius:"50%"},children:(0,O.jsx)(Q.Z,{variant:"square",sx:{...i.typography.commonAvatar,...i.typography.mediumAvatar,transition:"all .2s ease-in-out",background:i.palette.error.light,ml:1,"&:hover":{background:i.palette.error.dark}},color:"inherit",onClick:()=>x(!1),children:(0,O.jsx)(W.kLi,{stroke:1.5,size:"1.3rem"})})})]})]}),(0,O.jsxs)(p.Z,{children:[(null===t||void 0===t?void 0:t.id)&&(0,O.jsx)($.Z,{title:"API Endpoint",sx:{borderRadius:"50%",mr:2},children:(0,O.jsx)(Q.Z,{variant:"square",sx:{...i.typography.commonAvatar,...i.typography.mediumAvatar,transition:"all .2s ease-in-out",background:i.palette.canvasHeader.deployLight,color:i.palette.canvasHeader.deployDark,"&:hover":{background:i.palette.canvasHeader.deployDark,color:i.palette.canvasHeader.deployLight}},color:"inherit",onClick:()=>{let e=!1;try{const n=JSON.parse(t.flowData).nodes;for(const t of n)if(t.data.inputParams.find((e=>"file"===e.type))){e=!0;break}}catch(a){console.error(a)}let n=!1;try{const e=JSON.parse(t.flowData).nodes;for(const t of e)if(t.data.inputParams.find((e=>"sessionId"===e.name))){n=!0;break}}catch(a){console.error(a)}I({title:"Embed in website or use as API",chatflowid:t.id,chatflowApiKeyId:t.apikeyid,isFormDataRequired:e,isSessionMemory:n}),Z(!0)},children:(0,O.jsx)(W.seM,{stroke:1.5,size:"1.3rem"})})}),(0,O.jsx)($.Z,{title:"Save Chatflow",sx:{borderRadius:"50%",mr:2},children:(0,O.jsx)(Q.Z,{variant:"square",sx:{...i.typography.commonAvatar,...i.typography.mediumAvatar,transition:"all .2s ease-in-out",background:"#9D4B8E",color:"#fff","&:hover":{backgroundColor:"#83076c",color:"#fff"}},color:"inherit",onClick:()=>{t.id?n(y):S(!0)},children:(0,O.jsx)(W.e11,{stroke:1.5,size:"1.3rem"})})}),(0,O.jsx)($.Z,{ref:m,title:"Settings",sx:{borderRadius:"50%"},children:(0,O.jsx)(Q.Z,{variant:"square",sx:{...i.typography.commonAvatar,...i.typography.mediumAvatar,transition:"all .2s ease-in-out",background:"#E19379",color:"#ffffff","&:hover":{background:"#df6a43",color:"#ffffff"}},onClick:()=>b(!j),children:(0,O.jsx)(W.iCC,{stroke:1.5,size:"1.3rem"})})})]}),(0,O.jsx)(ue,{chatflow:t,isSettingsOpen:j,anchorEl:m.current,onClose:()=>b(!1),onSettingsItemClick:e=>{if(b(!1),"deleteChatflow"===e)o();else if("conversationStarters"===e)L({title:"Starter Prompts - "+t.name,chatflow:t}),M(!0);else if("analyseChatflow"===e)N({title:"Analyse Chatflow",chatflow:t}),T(!0);else if("viewMessages"===e)J({title:"View Messages",chatflow:t}),q(!0);else if("duplicateChatflow"===e)try{localStorage.setItem("duplicatedFlowData",t.flowData),window.open("".concat(B.kZ,"/canvas"),"_blank")}catch(n){console.error(n)}else if("exportChatflow"===e)try{const e=JSON.parse(t.flowData);let n=JSON.stringify((0,$e.mx)(e),null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(n),o="".concat(t.name," Chatflow.json"),s=document.createElement("a");s.setAttribute("href",a),s.setAttribute("download",o),s.click()}catch(n){console.error(n)}},onUploadFile:e=>{b(!1),s(e)}}),(0,O.jsx)(he.Z,{show:C,dialogProps:{title:"Save New Chatflow",confirmButtonName:"Save",cancelButtonName:"Cancel"},onCancel:()=>S(!1),onConfirm:e=>{S(!1),n(e)}}),(0,O.jsx)(tt,{show:k,dialogProps:D,onCancel:()=>Z(!1)}),(0,O.jsx)(dt,{show:P,dialogProps:A,onCancel:()=>T(!1)}),(0,O.jsx)(Ot.Z,{show:E,dialogProps:R,onConfirm:()=>M(!1),onCancel:()=>M(!1)}),(0,O.jsx)(Ft,{show:F,dialogProps:z,onCancel:()=>q(!1)})]})};var Bt=n(11100),zt=n(10907);const Jt=(0,x.ZP)(zt.Z)((e=>{let{theme:t,color:n="primary"}=e;return{background:"#469DBB",color:"#fff",borderRadius:0,variant:"extended","&:hover":{backgroundColor:"#2398c1",color:"#fff",backgroundImage:"linear-gradient(rgb(0 0 0/10%) 0 0)"}}})),Ut=e=>{let{nodesData:t,node:n}=e;const o=(0,g.Z)(),s=(0,r.v9)((e=>e.customization)),i=(0,r.I0)(),[l,c]=(0,a.useState)(""),[u,h]=(0,a.useState)({}),[m,f]=(0,a.useState)(!1),[x,y]=(0,a.useState)({}),j=(0,a.useRef)(null),b=(0,a.useRef)(m),S=(0,a.useRef)(),k=()=>{const e=S.current;e&&(e.scrollTop=0)},Z=e=>{c(e),setTimeout((()=>{if(e){const n=(e=>t.filter((t=>{const n=t.name.toLowerCase().includes(e.toLowerCase()),a=t.category.toLowerCase().includes(e.toLowerCase());return n||a})))(e);D(n,!0),k()}else""===e&&(D(t),k())}),500)},D=(e,t)=>{const n={},a=e.reduce((function(e,a){return e[a.category]=e[a.category]||[],e[a.category].push(a),n[a.category]=!!t,e}),Object.create(null));h(a),((e,t,n)=>{var a;const o={...e},s=null!==(a=o["Vector Stores"])&&void 0!==a?a:[],i=[],r=[];for(const l of s)"DEPRECATING"===l.badge?i.push(l):r.push(l);delete o["Vector Stores"],i.length&&(o["Vector Stores;DEPRECATING"]=i,t["Vector Stores;DEPRECATING"]=!!n),r.length&&(o["Vector Stores;NEW"]=r,t["Vector Stores;NEW"]=!!n),h(o)})(a,n,t),y(n)},I=e=>(t,n)=>{const a={...x};a[e]=n,y(a)},P=e=>{j.current&&j.current.contains(e.target)||f(!1)};return(0,a.useEffect)((()=>{!0===b.current&&!1===m&&j.current.focus(),b.current=m}),[m]),(0,a.useEffect)((()=>{n&&f(!1)}),[n]),(0,a.useEffect)((()=>{t&&(D(t),i({type:d.gU,componentNodes:t}))}),[t,i]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Jt,{sx:{left:20,top:20},ref:j,size:"small","aria-label":"add",title:"Add Node",onClick:()=>{f((e=>!e))},children:m?(0,O.jsx)(W.UrD,{}):(0,O.jsx)(W.SC9,{})}),(0,O.jsx)(ne.Z,{placement:"bottom-end",open:m,anchorEl:j.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[-40,14]}}]},sx:{zIndex:1e3},children:e=>{let{TransitionProps:t}=e;return(0,O.jsx)(re.Z,{in:m,...t,children:(0,O.jsx)(N.Z,{children:(0,O.jsx)(ae.d,{onClickAway:P,children:(0,O.jsxs)(C.Z,{border:!1,elevation:16,content:!1,boxShadow:!0,shadow:o.shadows[16],children:[(0,O.jsxs)(p.Z,{sx:{p:2},children:[(0,O.jsx)(ee.Z,{children:(0,O.jsx)(v.Z,{variant:"h4",children:"Add Nodes"})}),(0,O.jsx)(Ce.Z,{sx:{width:"100%",pr:2,pl:2,my:2},id:"input-search-node",value:l,onChange:e=>Z(e.target.value),placeholder:"Search nodes",startAdornment:(0,O.jsx)(Bt.Z,{position:"start",children:(0,O.jsx)(W.jVj,{stroke:1.5,size:"1rem",color:o.palette.grey[500]})}),endAdornment:(0,O.jsx)(Bt.Z,{position:"end",sx:{cursor:"pointer",color:o.palette.grey[500],"&:hover":{color:o.palette.grey[900]}},title:"Clear Search",children:(0,O.jsx)(W.kLi,{stroke:1.5,size:"1rem",onClick:()=>Z(""),style:{cursor:"pointer"}})}),"aria-describedby":"search-helper-text",inputProps:{"aria-label":"weight"}}),(0,O.jsx)(w.Z,{})]}),(0,O.jsx)(ie(),{containerRef:e=>{S.current=e},style:{height:"100%",maxHeight:"calc(100vh - 320px)",overflowX:"hidden"},children:(0,O.jsx)(p.Z,{sx:{p:2},children:(0,O.jsx)(oe.Z,{sx:{width:"100%",maxWidth:370,py:0,borderRadius:"10px",[o.breakpoints.down("md")]:{maxWidth:370},"& .MuiListItemSecondaryAction-root":{top:22},"& .MuiDivider-root":{my:0},"& .list-container":{pl:7}},children:Object.keys(u).sort().map((e=>"Vector Stores"===e?(0,O.jsx)(O.Fragment,{}):(0,O.jsxs)(fe.Z,{expanded:x[e]||!1,onChange:I(e),disableGutters:!0,children:[(0,O.jsx)(ge.Z,{expandIcon:(0,O.jsx)(ve.Z,{}),"aria-controls":"nodes-accordian-".concat(e),id:"nodes-accordian-header-".concat(e),children:e.split(";").length>1?(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,O.jsx)(v.Z,{variant:"h5",children:e.split(";")[0]}),"\xa0",(0,O.jsx)(vt.Z,{sx:{width:"max-content",fontWeight:700,fontSize:"0.65rem",background:"DEPRECATING"===e.split(";")[1]?o.palette.warning.main:o.palette.teal.main,color:"DEPRECATING"!==e.split(";")[1]?"white":"inherit"},size:"small",label:e.split(";")[1]})]}):(0,O.jsx)(v.Z,{variant:"h5",children:e})}),(0,O.jsx)(xe.Z,{children:u[e].map(((t,n)=>(0,O.jsxs)("div",{onDragStart:e=>((e,t)=>{e.dataTransfer.setData("application/reactflow",JSON.stringify(t)),e.dataTransfer.effectAllowed="move"})(e,t),draggable:!0,children:[(0,O.jsx)(yt.Z,{sx:{p:0,borderRadius:"".concat(s.borderRadius,"px"),cursor:"move","&:hover span":{color:s.isDarkMode?"#FFF860 !important":"#fff !important"},"&:hover p":{color:s.isDarkMode?"#fff !important":"#d9d1d1 !important"}},children:(0,O.jsxs)(nt.ZP,{alignItems:"center",children:[(0,O.jsx)(at.Z,{children:(0,O.jsx)("div",{style:{width:50,height:50,backgroundColor:"#EEEEEE"},children:(0,O.jsx)("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:t.name,src:"".concat(B.v2,"/api/v1/node-icon/").concat(t.name)})})}),(0,O.jsx)(ot.Z,{sx:{ml:1},primary:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,O.jsx)("span",{style:{color:s.isDarkMode?"#FFF860":"#121D35"},children:t.label}),"\xa0",t.badge&&(0,O.jsx)(vt.Z,{sx:{width:"max-content",fontWeight:700,fontSize:"0.65rem",background:"DEPRECATING"===t.badge?o.palette.warning.main:o.palette.teal.main,color:"DEPRECATING"!==t.badge?"white":"inherit"},size:"small",label:t.badge})]}),secondary:t.description})]})}),n===u[e].length-1?null:(0,O.jsx)(w.Z,{})]},t.name)))})]},e)))})})})]})})})})}})]})};var Ht=n(48349),_t=n(1675),Wt=n(94267);const Kt=(e,t)=>z.Z.post("/internal-prediction/".concat(e),t),Gt=e=>{let{isGrid:t,starterPrompts:n,onPromptClick:a}=e;return(0,O.jsx)(p.Z,{className:"button-container",sx:{maxWidth:t?"inherit":"400px",m:1},children:n.map(((e,t)=>(0,O.jsx)(vt.Z,{label:e.prompt,className:"button",onClick:t=>a(e.prompt,t)},t)))})},Vt=e=>{let{open:t,chatflowid:n,isDialog:o}=e;const s=(0,g.Z)(),i=(0,r.v9)((e=>e.customization)),l=(0,a.useRef)(),[c,d]=(0,a.useState)(""),[m,f]=(0,a.useState)(!1),[x,v]=(0,a.useState)([{message:"Hi there! How can I help?",type:"apiMessage"}]),[j,b]=(0,a.useState)(""),[C,S]=(0,a.useState)(!1),[k,Z]=(0,a.useState)(!1),[D,I]=(0,a.useState)({}),[P,T]=(0,a.useState)(void 0),A=(0,a.useRef)(null),N=(0,H.Z)(At),E=(0,H.Z)(De.Z.getIsChatflowStreaming),M=(0,H.Z)(De.Z.getSpecificChatflow),[R,L]=(0,a.useState)([]),F=(e,t)=>{I({data:e,title:t}),Z(!0)},q=()=>{l.current&&l.current.scrollTo({top:B.bs})},z=(0,a.useCallback)((e=>d(e.target.value)),[d]),J=e=>{v((t=>{let n=[...(0,u.cloneDeep)(t)];return"userMessage"===n[n.length-1].type||(n[n.length-1].message+=e),n}))},U=e=>{v((t=>{let n=[...(0,u.cloneDeep)(t)];return"userMessage"===n[n.length-1].type||(n[n.length-1].sourceDocuments=e),n}))},_=async(e,t)=>{if(e&&e.preventDefault(),!t&&""===c.trim())return;let a=c;void 0!==t&&""!==t.trim()&&(a=t),f(!0),v((e=>[...e,{message:a,type:"userMessage"}]));try{const e={question:a,history:x.filter((e=>"Hi there! How can I help?"!==e.message)),chatId:P};C&&(e.socketIOClientId=j);const t=await Kt(n,e);if(t.data){const e=t.data;if(P||T(e.chatId),!C){let t="";t=e.text?e.text:e.json?"```json\n"+JSON.stringify(e.json,null,2):JSON.stringify(e,null,2),v((n=>[...n,{message:t,sourceDocuments:null===e||void 0===e?void 0:e.sourceDocuments,usedTools:null===e||void 0===e?void 0:e.usedTools,fileAnnotations:null===e||void 0===e?void 0:e.fileAnnotations,type:"apiMessage"}]))}(0,$e.AS)(n,e.chatId,x),f(!1),d(""),setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus(),q()}),100)}}catch(o){return void function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Oops! There seems to be an error. Please try again.";e=e.replace("Unable to parse JSON response from chat agent.\n\n",""),v((t=>[...t,{message:e,type:"apiMessage"}])),f(!1),d(""),setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus()}),100)}(o.response.data||"".concat(o.response.status,": ").concat(o.response.statusText))}};return(0,a.useEffect)((()=>{var e;if(null!==(e=N.data)&&void 0!==e&&e.length){var t;const e=null===(t=N.data[0])||void 0===t?void 0:t.chatId;T(e);const a=N.data.map((e=>{const t={message:e.content,type:e.role};return e.sourceDocuments&&(t.sourceDocuments=JSON.parse(e.sourceDocuments)),e.usedTools&&(t.usedTools=JSON.parse(e.usedTools)),e.fileAnnotations&&(t.fileAnnotations=JSON.parse(e.fileAnnotations)),t}));v((e=>[...e,...a])),(0,$e.AS)(n,e,x)}}),[N.data]),(0,a.useEffect)((()=>{var e,t;E.data&&S(null!==(e=null===(t=E.data)||void 0===t?void 0:t.isStreaming)&&void 0!==e&&e)}),[E.data]),(0,a.useEffect)((()=>{var e,t;if(M.data&&(null!==(e=M.data)&&void 0!==e&&e.chatbotConfig&&JSON.parse(null===(t=M.data)||void 0===t?void 0:t.chatbotConfig))){var n;let e=JSON.parse(null===(n=M.data)||void 0===n?void 0:n.chatbotConfig);if(e.starterPrompts){let t=[];Object.getOwnPropertyNames(e.starterPrompts).forEach((n=>{e.starterPrompts[n]&&t.push(e.starterPrompts[n])})),L(t)}}}),[M.data]),(0,a.useEffect)((()=>{q()}),[x]),(0,a.useEffect)((()=>{o&&A&&setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus()}),100)}),[o,A]),(0,a.useEffect)((()=>{let e;return t&&n&&(N.request(n),E.request(n),M.request(n),q(),e=(0,_t.ZP)(B.v2),e.on("connect",(()=>{b(e.id)})),e.on("start",(()=>{v((e=>[...e,{message:"",type:"apiMessage"}]))})),e.on("sourceDocuments",U),e.on("token",J)),()=>{d(""),f(!1),v([{message:"Hi there! How can I help?",type:"apiMessage"}]),e&&(e.disconnect(),b(""))}}),[t,n]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:o?"cloud-dialog":"cloud",children:(0,O.jsx)("div",{ref:l,className:"messagelist",children:x&&x.map(((e,t)=>(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(p.Z,{sx:{background:"apiMessage"===e.type?s.palette.asyncSelect.main:""},style:{display:"flex"},className:"userMessage"===e.type&&m&&t===x.length-1?i.isDarkMode?"usermessagewaiting-dark":"usermessagewaiting-light":"usermessagewaiting"===e.type?"apimessage":"usermessage",children:["apiMessage"===e.type?(0,O.jsx)("img",{src:bt,alt:"AI",width:"30",height:"30",className:"boticon"}):(0,O.jsx)("img",{src:Ct,alt:"Me",width:"30",height:"30",className:"usericon"}),(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[e.usedTools&&(0,O.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.usedTools.map(((e,t)=>(0,O.jsx)(vt.Z,{size:"small",label:e.tool,component:"a",sx:{mr:1,mt:1},variant:"outlined",clickable:!0,onClick:()=>F(e,"Used Tools")},t)))}),(0,O.jsx)("div",{className:"markdownanswer",children:(0,O.jsx)(kt.s,{remarkPlugins:[ft.Z,gt.Z],rehypePlugins:[pt.Z,mt.Z],components:{code(e){let{inline:t,className:a,children:s,...i}=e;const r=/language-(\w+)/.exec(a||"");return t?(0,O.jsx)("code",{className:a,...i,children:s}):(0,O.jsx)(Zt.d,{chatflowid:n,isDialog:o,language:r&&r[1]||"",value:String(s).replace(/\n$/,""),...i},Math.random())}},children:e.message})}),e.fileAnnotations&&(0,O.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:e.fileAnnotations.map(((e,t)=>(0,O.jsx)(h.Z,{sx:{fontSize:"0.85rem",textTransform:"none",mb:1},variant:"outlined",onClick:()=>(async e=>{try{const t=await xt.Z.post("".concat(B.v2,"/api/v1/openai-assistants-file"),{fileName:e.fileName},{responseType:"blob"}),n=new Blob([t.data],{type:t.headers["content-type"]}),a=window.URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=e.fileName,document.body.appendChild(o),o.click(),o.remove()}catch(t){console.error("Download failed:",t)}})(e),endIcon:(0,O.jsx)(W.DjJ,{color:s.palette.primary.main}),children:e.fileName},t)))}),e.sourceDocuments&&(0,O.jsx)("div",{style:{display:"block",flexDirection:"row",width:"100%"},children:(0,$e.oY)(e).map(((e,t)=>{const n=e.metadata&&e.metadata.source?(0,$e.K2)(e.metadata.source):void 0;return(0,O.jsx)(vt.Z,{size:"small",label:n?"/"===n.pathname.substring(0,15)?n.host:"".concat(n.pathname.substring(0,15),"..."):"".concat(e.pageContent.substring(0,15),"..."),component:"a",sx:{mr:1,mb:1},variant:"outlined",clickable:!0,onClick:()=>{return n?(t=e.metadata.source,void window.open(t,"_blank")):F(e);var t}},t)}))})]})]},t)})))})}),(0,O.jsxs)("div",{style:{position:"relative"},children:[x&&1===x.length&&(0,O.jsx)(Gt,{starterPrompts:R||[],onPromptClick:async e=>{d(e),_(void 0,e)},isGrid:o}),(0,O.jsx)(w.Z,{})]}),(0,O.jsx)("div",{className:"center",children:(0,O.jsx)("div",{style:{width:"100%"},children:(0,O.jsx)("form",{style:{width:"100%"},onSubmit:_,children:(0,O.jsx)(Ce.Z,{inputRef:A,autoFocus:!0,sx:{width:"100%"},disabled:m||!n,onKeyDown:e=>{const t=e.isComposing||229===e.keyCode;"Enter"===e.key&&c&&!t?!e.shiftKey&&c&&_(e):"Enter"===e.key&&e.preventDefault()},id:"userInput",name:"userInput",placeholder:m?"Waiting for response...":"Type your question...",value:c,onChange:z,multiline:!0,maxRows:o?7:2,endAdornment:(0,O.jsx)(Bt.Z,{position:"end",sx:{padding:"15px"},children:(0,O.jsx)(y.Z,{type:"submit",disabled:m||!n,edge:"end",children:m?(0,O.jsx)("div",{children:(0,O.jsx)(Wt.Z,{color:"inherit",size:20})}):(0,O.jsx)(W.h9l,{color:m||!n?"#9e9e9e":i.isDarkMode?"white":"#1e88e5"})})})})})})}),(0,O.jsx)(Pt,{show:k,dialogProps:D,onCancel:()=>Z(!1)})]})},Yt=e=>{let{show:t,dialogProps:n,onClear:a,onCancel:o}=e;const s=document.getElementById("portal"),i=(0,r.v9)((e=>e.customization)),l=t?(0,O.jsxs)(I.Z,{open:t,fullWidth:!0,maxWidth:"md",onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{overflow:"visible"},children:[(0,O.jsx)(P.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[n.title,(0,O.jsx)("div",{style:{flex:1}}),i.isDarkMode&&(0,O.jsx)(ke.S,{variant:"outlined",color:"error",title:"Clear Conversation",onClick:a,startIcon:(0,O.jsx)(W.W7f,{}),children:"Clear Chat"}),!i.isDarkMode&&(0,O.jsx)(h.Z,{variant:"outlined",color:"error",title:"Clear Conversation",onClick:a,startIcon:(0,O.jsx)(W.W7f,{}),children:"Clear Chat"})]})}),(0,O.jsx)(T.Z,{sx:{display:"flex",justifyContent:"flex-end",flexDirection:"column"},children:(0,O.jsx)(Vt,{isDialog:!0,open:n.open,chatflowid:n.chatflowid})})]}):null;return(0,D.createPortal)(l,s)},Xt=e=>{let{chatflowid:t}=e;const n=(0,g.Z)(),{confirm:o}=(0,Rt.Z)(),s=(0,r.I0)();(0,Ie.Z)();const i=function(){return s((0,d.yv)(...arguments))},l=function(){return s((0,d.sy)(...arguments))},[c,u]=(0,a.useState)(!1),[p,m]=(0,a.useState)(!1),[f,x]=(0,a.useState)({}),y=(0,a.useRef)(null),v=(0,a.useRef)(c),w=e=>{y.current&&y.current.contains(e.target)||u(!1)},j=async()=>{if(await o({title:"Clear Chat History",description:"Are you sure you want to clear all chat history?",confirmButtonName:"Clear",cancelButtonName:"Cancel"}))try{const e=localStorage.getItem("".concat(t,"_INTERNAL"));if(!e)return;const n=JSON.parse(e);await Mt(t,{chatId:n.chatId,chatType:"INTERNAL"}),localStorage.removeItem("".concat(t,"_INTERNAL")),(()=>{const e={...f,open:!1};x(e),setTimeout((()=>{const e={...f,open:!0};x(e)}),500)})(),i({message:"Succesfully cleared all chat history",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>l(e),children:(0,O.jsx)(W.kLi,{})})}})}catch(e){const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);i({message:t,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>l(e),children:(0,O.jsx)(W.kLi,{})})}})}};return(0,a.useEffect)((()=>{!0===v.current&&!1===c&&y.current.focus(),v.current=c}),[c,t]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Jt,{sx:{position:"absolute",right:20,top:20},ref:y,size:"small",color:"secondary","aria-label":"chat",title:"Chat",onClick:()=>{u((e=>!e))},children:c?(0,O.jsx)(W.kLi,{}):(0,O.jsx)(W.fu1,{})}),c&&(0,O.jsx)(Jt,{sx:{position:"absolute",right:80,top:20},onClick:j,size:"small","aria-label":"clear",title:"Clear Chat History",children:(0,O.jsx)(W.W7f,{})}),c&&(0,O.jsx)(Jt,{sx:{position:"absolute",right:140,top:20},onClick:()=>{x({open:!0,chatflowid:t}),m(!0)},size:"small",color:"primary","aria-label":"expand",title:"Expand Chat",children:(0,O.jsx)(W.ybr,{})}),(0,O.jsx)(ne.Z,{placement:"bottom-end",open:c,anchorEl:y.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[40,14]}}]},sx:{zIndex:1e3},children:e=>{let{TransitionProps:a}=e;return(0,O.jsx)(re.Z,{in:c,...a,children:(0,O.jsx)(N.Z,{children:(0,O.jsx)(ae.d,{onClickAway:w,children:(0,O.jsx)(C.Z,{border:!1,elevation:16,content:!1,boxShadow:!0,shadow:n.shadows[16],children:(0,O.jsx)(Vt,{chatflowid:t,open:c})})})})})}}),(0,O.jsx)(Yt,{show:p,dialogProps:f,onClear:j,onCancel:()=>m(!1)})]})};var $t=n(72795);const Qt=(e,t)=>z.Z.post("/vector/internal-upsert/".concat(e),t);function en(e){const{children:t,value:n,index:a,...o}=e;return(0,O.jsx)("div",{role:"tabpanel",hidden:n!==a,id:"attachment-tabpanel-".concat(a),"aria-labelledby":"attachment-tab-".concat(a),...o,children:n===a&&(0,O.jsx)(p.Z,{sx:{p:1},children:t})})}function tn(e){return{id:"attachment-tab-".concat(e),"aria-controls":"attachment-tabpanel-".concat(e)}}const nn=e=>{let{show:t,dialogProps:n,onCancel:o}=e;const s=document.getElementById("portal"),{reactFlowInstance:i}=(0,a.useContext)(K.K),l=(0,r.I0)();(0,Ie.Z)();const c=function(){return l((0,d.yv)(...arguments))},u=function(){return l((0,d.sy)(...arguments))},m=(0,H.Z)(J),[f,g]=(0,a.useState)([]),[x,y]=(0,a.useState)(!1),[w,j]=(0,a.useState)({}),[b,C]=(0,a.useState)({}),[S,k]=(0,a.useState)({}),[Z,A]=(0,a.useState)(0),[N,E]=(0,a.useState)(""),[M,R]=(0,a.useState)({}),L=(e,t,a,o)=>"Python"===e?'import requests\n\nAPI_URL = "'.concat(B.v2,"/api/v1/vector/upsert/").concat(n.chatflowid,'"\n\ndef query(payload):\n    response = requests.post(API_URL, json=payload)\n    return response.json()\n\noutput = query({\n    ').concat(a?'"stopNodeId": "'.concat(t,'",\n    '):"",'"overrideConfig": {').concat((0,$e.nJ)(o,"json",a,t),"\n    }\n})\n"):"JavaScript"===e?'async function query(data) {\n    const response = await fetch(\n        "'.concat(B.v2,"/api/v1/vector/upsert/").concat(n.chatflowid,'",\n        {\n            method: "POST",\n            headers: {\n                "Content-Type": "application/json"\n            },\n            body: JSON.stringify(data)\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery({\n  ').concat(a?'"stopNodeId": "'.concat(t,'",\n  '):"",'"overrideConfig": {').concat((0,$e.Ln)(o,"json",a,t),"\n  }\n}).then((response) => {\n    console.log(response);\n});\n"):"cURL"===e?"curl ".concat(B.v2,"/api/v1/vector/upsert/").concat(n.chatflowid," \\\n      -X POST \\\n      ").concat(a?'-d \'{"stopNodeId": "'.concat(t,'", "overrideConfig": {').concat((0,$e.CJ)(o,"json",a,t),"}' \\"):'-d \'{"overrideConfig": {'.concat((0,$e.CJ)(o,"json",a,t),"}' \\"),'\n      -H "Content-Type: application/json"'):"",F=(e,t,a,o)=>{if("Python"===e){let e=(o=(0,$e.VN)(o))[0].type;return e.includes(",")&&(e=e.split(",")[0]),'import requests\n\nAPI_URL = "'.concat(B.v2,"/api/v1/vector/upsert/").concat(n.chatflowid,'"\n\n# use form data to upload files\nform_data = {\n    "files": ',"('example".concat(e,"', open('example").concat(e,"', 'rb'))"),"\n}\nbody_data = {").concat((0,$e.nJ)(o,"formData",a,t),"}\n\ndef query(form_data, body_data):\n    response = requests.post(API_URL, files=form_data, data=body_data)\n    return response.json()\n\noutput = query(form_data, body_data)\n")}return"JavaScript"===e?"// use FormData to upload files\nlet formData = new FormData();\n".concat((0,$e.Ln)(o,"formData",a,t),'\nasync function query(formData) {\n    const response = await fetch(\n        "').concat(B.v2,"/api/v1/vector/upsert/").concat(n.chatflowid,'",\n        {\n            method: "POST",\n            body: formData\n        }\n    );\n    const result = await response.json();\n    return result;\n}\n\nquery(formData).then((response) => {\n    console.log(response);\n});\n'):"cURL"===e?"curl ".concat(B.v2,"/api/v1/vector/upsert/").concat(n.chatflowid," \\\n     -X POST \\").concat((0,$e.CJ)(o,"formData",a,t),' \\\n     -H "Content-Type: multipart/form-data"'):""},z=e=>"Python"===e?"python":"JavaScript"===e?"javascript":"cURL"===e?"bash":"python",U=e=>"Python"===e?_e:"JavaScript"===e?We:"Embed"===e?EmbedSVG:"cURL"===e?Ke:"Share Chatbot"===e?ShareChatbotSVG:"Configuration"===e?settingsSVG:_e,_=e=>{const t=[],n=Object.keys(e.data.inputs);for(let o=0;o<e.data.inputParams.length;o+=1){var a;if(n.includes(e.data.inputParams[o].name))t.push({label:e.data.inputParams[o].label,name:e.data.inputParams[o].name,type:e.data.inputParams[o].type,value:"file"===e.data.inputParams[o].type?(0,$e.UO)(e.data.inputs[e.data.inputParams[o].name]):null!==(a=e.data.inputs[e.data.inputParams[o].name])&&void 0!==a?a:""})}return t};(0,a.useEffect)((()=>{if(m.data){var e,t;const n={...M};n[N]=((e,t)=>e.filter((e=>t.some((t=>e.nodeId===t.id)))))(m.data,null!==(e=null===(t=f.find((e=>e.vectorNode.data.id===N)))||void 0===t?void 0:t.nodes)&&void 0!==e?e:[]),R(n)}}),[m.data]),(0,a.useEffect)((()=>{if(n&&i){const e=i.getNodes(),t=i.getEdges();g((0,$e.Fd)(e,t))}return()=>{g([]),y(!1),j({}),C({}),k({}),A(0),R({})}}),[n]),(0,a.useEffect)((()=>(l(t?{type:d.tS}:{type:d.Go}),()=>l({type:d.Go}))),[t,l]);const G=t?(0,O.jsxs)(I.Z,{open:t,fullWidth:!0,maxWidth:"md",onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{overflow:"visible"},children:[(0,O.jsx)(P.Z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:n.title}),(0,O.jsx)(T.Z,{sx:{display:"flex",justifyContent:"flex-end",flexDirection:"column"},children:(0,O.jsx)(ie(),{style:{height:"100%",maxHeight:"calc(100vh - 220px)",overflowX:"hidden"},children:f.length>0&&f.map(((e,t)=>(0,O.jsxs)("div",{children:[e.nodes.length>0&&e.nodes.map(((e,t)=>{return(0,O.jsxs)(fe.Z,{expanded:b[e.data.id]||!1,onChange:(n=e.data.id,(e,t)=>{const a={...b};a[n]=t,C(a)}),disableGutters:!0,children:[(0,O.jsx)(ge.Z,{expandIcon:(0,O.jsx)(ve.Z,{}),"aria-controls":"nodes-accordian-".concat(e.data.name),id:"nodes-accordian-header-".concat(e.data.name),children:(0,O.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,O.jsx)("div",{style:{width:40,height:40,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:(0,O.jsx)("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:e.data.name,src:"".concat(B.v2,"/api/v1/node-icon/").concat(e.data.name)})}),(0,O.jsx)(v.Z,{variant:"h5",children:e.data.label}),(0,O.jsx)("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:(0,O.jsx)("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:e.data.id})})]})}),(0,O.jsx)(xe.Z,{children:(0,O.jsx)(q,{sx:{minWidth:"max-content"},rows:_(e),columns:Object.keys(_(e)[0])})})]},t);var n})),(0,O.jsxs)(p.Z,{sx:{p:2},children:[(0,O.jsx)(Oe,{label:"Show API",value:S[e.vectorNode.data.id],onChange:()=>(e=>{var t,a;const o={...S};Object.keys(o).includes(e)?o[e]=!o[e]:o[e]=!0,!0===o[e]&&m.request(n.chatflowid),k(o),E(e);const s={...w};s[e]=!1,j(s);const i=null!==(t=null===(a=f.find((t=>t.vectorNode.data.id===e)))||void 0===a?void 0:a.nodes)&&void 0!==t?t:[];for(const n of i)if(n.data.inputParams.find((e=>"file"===e.type))){s[e]=!0,j(s);break}})(e.vectorNode.data.id)},JSON.stringify(S)),S[e.vectorNode.data.id]&&(0,O.jsx)("div",{children:(0,O.jsx)(pe.Z,{value:Z,onChange:(e,t)=>A(t),"aria-label":"tabs",children:["Python","JavaScript","cURL"].map(((e,t)=>(0,O.jsx)(me.Z,{icon:(0,O.jsx)("img",{style:{objectFit:"cover",height:15,width:"auto"},src:U(e),alt:"code"}),iconPosition:"start",label:e,...tn(t)},t)))})}),S[e.vectorNode.data.id]&&void 0!==w[e.vectorNode.data.id]&&M[e.vectorNode.data.id]&&M[e.vectorNode.data.id].length>0&&(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("div",{style:{marginTop:10},children:["Python","JavaScript","cURL"].map(((t,n)=>(0,O.jsx)(en,{value:Z,index:n,children:(0,O.jsx)(ye.Z1,{theme:ye.FE,text:w[e.vectorNode.data.id]?F(t,e.vectorNode.data.id,f.length>1,M[e.vectorNode.data.id]):L(t,e.vectorNode.data.id,f.length>1,M[e.vectorNode.data.id]),language:z(t),showLineNumbers:!1,wrapLines:!0})},n)))})})]}),(0,O.jsxs)("div",{style:{marginBottom:"20px"},children:[x&&(0,O.jsx)($t.E,{open:x}),!x&&(0,O.jsx)(h.Z,{sx:{color:"white"},fullWidth:!0,variant:"contained",color:"teal",title:"Upsert",onClick:()=>(async e=>{y(!0);try{await Qt(n.chatflowid,{stopNodeId:e.data.id}),c({message:"Succesfully upserted vector store. You can start chatting now!",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>u(e),children:(0,O.jsx)(W.kLi,{})})}}),y(!1)}catch(t){const e=t.response.data||"".concat(t.response.status,": ").concat(t.response.statusText);c({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>u(e),children:(0,O.jsx)(W.kLi,{})})}}),y(!1)}})(e.vectorNode),children:"Upsert"})]})]},t)))})})]}):null;return(0,D.createPortal)(G,s)},an=e=>{let{chatflowid:t}=e;const n=(0,r.I0)();(0,Ie.Z)();const o=function(){return n((0,d.yv)(...arguments))},s=function(){return n((0,d.sy)(...arguments))},[i,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[p,m]=(0,a.useState)({}),f=(0,a.useRef)(null),g=(0,a.useRef)(i);return(0,a.useEffect)((()=>{!0===g.current&&!1===i&&f.current.focus(),g.current=i}),[i,t]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Jt,{sx:{position:"absolute",right:80,top:20},ref:f,size:"small",color:"teal","aria-label":"upsert",title:"Upsert Vector Database",onClick:()=>{l((e=>!e));m({open:!0,title:"Upsert Vector Store",chatflowid:t}),u(!0)},children:i?(0,O.jsx)(W.kLi,{}):(0,O.jsx)(W.KPt,{})}),(0,O.jsx)(nn,{show:c,dialogProps:p,onUpsert:async()=>{try{await Qt(t,{}),o({message:"Succesfully upserted vector store",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>s(e),children:(0,O.jsx)(W.kLi,{})})}})}catch(e){const t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);o({message:t,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>s(e),children:(0,O.jsx)(W.kLi,{})})}})}},onCancel:()=>{u(!1),l((e=>!e))}})]})};var on=n(88719),sn=n(66798);const rn={customNode:Y},ln={buttonedge:X},cn=(0,sn.u3)((()=>{const e=(0,g.Z)(),t=(0,l.s0)(),{state:n}=(0,l.TH)(),x=n?n.templateFlowData:"",y=document.location.pathname.toString().split("/"),v="canvas"===y[y.length-1]?"":y[y.length-1],{confirm:w}=(0,Rt.Z)(),j=(0,r.I0)(),b=(0,r.v9)((e=>e.canvas)),[C,S]=(0,a.useState)(b),[k,Z]=(0,a.useState)(null),{reactFlowInstance:D,setReactFlowInstance:I}=(0,a.useContext)(K.K);(0,Ie.Z)();const P=function(){return j((0,d.yv)(...arguments))},T=function(){return j((0,d.sy)(...arguments))},[A,N,E]=(0,o.Rr)(),[M,R,L]=(0,o.ll)(),[F,q]=(0,a.useState)(null),[z,J]=(0,a.useState)(!1),U=(0,a.useRef)(null),_=(0,H.Z)(on.Z.getAllNodes),G=(0,H.Z)(De.Z.createNewChatflow),V=(0,H.Z)(De.Z.testChatflow),Y=(0,H.Z)(De.Z.updateChatflow),X=(0,H.Z)(De.Z.getSpecificChatflow),$=e=>{try{const t=JSON.parse(e),n=t.nodes||[];N(n),R(t.edges||[]),oe()}catch(t){console.error(t)}},Q=(0,a.useCallback)(((e,t)=>{q(t),N((e=>e.map((e=>(e.id===t.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))))})),ee=(0,a.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),te=(0,a.useCallback)((e=>{e.preventDefault();const t=U.current.getBoundingClientRect();let n=e.dataTransfer.getData("application/reactflow");if("undefined"===typeof n||!n)return;n=JSON.parse(n);const a=D.project({x:e.clientX-t.left-100,y:e.clientY-t.top-50}),o=(0,$e.VZ)(n,D.getNodes()),s={id:o,position:a,type:"customNode",data:(0,$e.qR)(n,o)};q(s),N((e=>e.concat(s).map((e=>(e.id===s.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e))))),setTimeout((()=>oe()),0)}),[D]),ne=()=>{j({type:d.cn}),P({message:"Chatflow saved",options:{key:(new Date).getTime()+Math.random(),variant:"success",action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>T(e),children:(0,O.jsx)(W.kLi,{})})}})},ae=e=>{P({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>T(e),children:(0,O.jsx)(W.kLi,{})})}})},oe=()=>{j({type:d.K8})};return(0,a.useEffect)((()=>{if(X.data){const e=X.data,t=e.flowData?JSON.parse(e.flowData):[];N(t.nodes||[]),R(t.edges||[]),j({type:d.ch,chatflow:e})}else if(X.error){const e=X.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);ae("Failed to retrieve chatflow: ".concat(t))}}),[X.data,X.error]),(0,a.useEffect)((()=>{if(G.data){const e=G.data;j({type:d.ch,chatflow:e}),ne(),window.history.replaceState(null,null,"/canvas/".concat(e.id))}else if(G.error){const e=G.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);ae("Failed to save chatflow: ".concat(t))}}),[G.data,G.error]),(0,a.useEffect)((()=>{if(Y.data)j({type:d.ch,chatflow:Y.data}),ne();else if(Y.error){const e=Y.error,t=e.response.data||"".concat(e.response.status,": ").concat(e.response.statusText);ae("Failed to save chatflow: ".concat(t))}}),[Y.data,Y.error]),(0,a.useEffect)((()=>{V.error&&P({message:"Test chatflow failed",options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>T(e),children:(0,O.jsx)(W.kLi,{})})}})}),[V.error]),(0,a.useEffect)((()=>{if(Z(C.chatflow),C.chatflow){const e=C.chatflow.flowData?JSON.parse(C.chatflow.flowData):[];((e,t)=>{(0,$e.Fd)(e,t).length?J(!0):J(!1)})(e.nodes||[],e.edges||[])}}),[C.chatflow]),(0,a.useEffect)((()=>(v?X.request(v):(localStorage.getItem("duplicatedFlowData")?($(localStorage.getItem("duplicatedFlowData")),setTimeout((()=>localStorage.removeItem("duplicatedFlowData")),0)):(N([]),R([])),j({type:d.ch,chatflow:{name:"Untitled chatflow"}})),_.request(),()=>{setTimeout((()=>j({type:d.cn})),0)})),[]),(0,a.useEffect)((()=>{S(b)}),[b]),(0,a.useEffect)((()=>{function e(e){const t=e.clipboardData.getData("text");t.includes('{"nodes":[')&&t.includes('],"edges":[')&&$(t)}return window.addEventListener("paste",e),()=>{window.removeEventListener("paste",e)}}),[]),(0,a.useEffect)((()=>{x&&x.includes('"nodes":[')&&x.includes('],"edges":[')&&$(x)}),[x]),c("You have unsaved changes! Do you want to navigate away?",C.isDirty),(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(p.Z,{children:[(0,O.jsx)(m.Z,{enableColorOnDark:!0,position:"fixed",color:"inherit",elevation:1,sx:{bgcolor:e.palette.background.default},children:(0,O.jsx)(f.Z,{children:(0,O.jsx)(qt,{chatflow:k,handleSaveFlow:e=>{if(D){const t=D.getNodes().map((e=>{const t=(0,u.cloneDeep)(e.data);return Object.prototype.hasOwnProperty.call(t.inputs,B.J6)&&(t.credential=t.inputs[B.J6],t.inputs=(0,u.omit)(t.inputs,[B.J6])),e.data={...t,selected:!1},e})),n=D.toObject();n.nodes=t;const a=JSON.stringify(n);if(k.id){const t={name:e,flowData:a};Y.request(k.id,t)}else{const t={name:e,deployed:!1,isPublic:!1,flowData:a};G.request(t)}}},handleDeleteFlow:async()=>{const e={title:"Delete",description:"Delete chatflow ".concat(k.name,"?"),confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await w(e))try{await De.Z.deleteChatflow(k.id),localStorage.removeItem("".concat(k.id,"_INTERNAL")),t("/")}catch(n){const e=n.response.data||"".concat(n.response.status,": ").concat(n.response.statusText);P({message:e,options:{key:(new Date).getTime()+Math.random(),variant:"error",persist:!0,action:e=>(0,O.jsx)(h.Z,{style:{color:"white"},onClick:()=>T(e),children:(0,O.jsx)(W.kLi,{})})}})}},handleLoadFlow:$})})}),(0,O.jsx)(p.Z,{sx:{pt:"70px",height:"100vh",width:"100%"},children:(0,O.jsx)("div",{className:"reactflow-parent-wrapper",children:(0,O.jsx)("div",{className:"reactflow-wrapper",ref:U,children:(0,O.jsxs)(o.x$,{nodes:A,edges:M,onNodesChange:E,onNodeClick:Q,onEdgesChange:L,onDrop:te,onDragOver:ee,onNodeDragStop:oe,nodeTypes:rn,edgeTypes:ln,onConnect:e=>{const t={...e,type:"buttonedge",id:"".concat(e.source,"-").concat(e.sourceHandle,"-").concat(e.target,"-").concat(e.targetHandle)},n=e.targetHandle.split("-")[0],a=e.sourceHandle.split("-")[0],s=e.targetHandle.split("-")[2];N((e=>e.map((e=>{if(e.id===n){let t;setTimeout((()=>oe()),0);const n=e.data.inputAnchors.find((e=>e.name===s)),o=e.data.inputParams.find((e=>e.name===s));if(n&&n.list){const n=e.data.inputs[s]||[];"tools"===s?(0,$e.kG)(n,a):n.push("{{".concat(a,".data.instance}}")),t=n}else t=o&&o.acceptVariable?e.data.inputs[s]||"":"{{".concat(a,".data.instance}}");e.data={...e.data,inputs:{...e.data.inputs,[s]:t}}}return e})))),R((e=>(0,o.Z_)(t,e)))},onInit:I,fitView:!0,deleteKeyCode:b.canvasDialogShow?null:["Backspace","Delete"],minZoom:.1,children:[(0,O.jsx)(s.Z,{style:{display:"flex",flexDirection:"row",left:"50%",transform:"translate(-50%, -50%)"}}),(0,O.jsx)(i.A,{color:"#aaa",gap:16}),(0,O.jsx)(Ut,{nodesData:_.data,node:F}),z&&(0,O.jsx)(an,{chatflowid:v}),(0,O.jsx)(Xt,{chatflowid:v})]})})})}),(0,O.jsx)(Ht.Z,{})]})})}))}}]);
//# sourceMappingURL=5801.3952a4a2.chunk.js.map